<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专业命理分析|深度八字算命</title>
    <style>
        /* 全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f2ea;
            color: #333;
            line-height: 1.6;
            background-color: #E1D1B0;
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* 导航栏样式 */
        .navbar {
            background-color: rgba(139, 0, 0, 0.9);
            color: #fff;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 20px;
        }

        .nav-links a {
            color: #fff;
            text-decoration: none;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #f8d56f;
        }

        /* 标题样式 */
        h1, h2, h3 {
            color: #8b0000;
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            font-size: 36px;
            margin: 30px 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        h2 {
            font-size: 28px;
            margin: 25px 0;
            position: relative;
            display: inline-block;
        }

        h2:after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #8b0000;
        }

        h3 {
            font-size: 22px;
            margin: 20px 0;
        }

        /* 表单样式 */
        .form-container {
            background-color: rgba(255, 255, 255, 0.92);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            margin: 30px auto;
            max-width: 800px;
            border: 1px solid #e0d5c1;
        }

        .form-group {
            margin-bottom: 20px;
        }
        
        .form-note {
            background-color: #e8f4ff;
            border-left: 4px solid #4a90e2;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 4px 4px 0;
        }
        
        .form-note p {
            margin: 0;
            color: #333;
            font-size: 14px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #8b0000;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #8b0000;
            box-shadow: 0 0 5px rgba(139, 0, 0, 0.3);
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* 按钮样式 */
        .btn {
            background-color: #8b0000;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s, transform 0.2s;
            display: inline-block;
            text-align: center;
            margin: 10px 5px;
        }

        .btn:hover {
            background-color: #a00000;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background-color: #666;
        }

        .btn-secondary:hover {
            background-color: #777;
        }

        /* 八字排盘结果样式 */
        .bazi-result {
            background-color: rgba(255, 255, 255, 0.92);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            margin: 30px auto;
            max-width: 1000px;
            border: 1px solid #e0d5c1;
            display: none;
        }

        .bazi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .bazi-column {
            background-color: #f8f4e9;
            border: 1px solid #d9c9a8;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }

        .bazi-column h3 {
            color: #8b0000;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .bazi-column .gan, .bazi-column .zhi {
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0;
        }

        .bazi-column .gan {
            color: #8b0000;
        }

        .bazi-column .zhi {
            color: #0066cc;
        }

        /* 五行分析样式 */
        .wuxing-analysis {
            margin: 30px 0;
        }

        .wuxing-chart {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .wuxing-item {
            text-align: center;
            padding: 15px;
            border-radius: 5px;
            width: 18%;
        }

        .wuxing-item.mu {
            background-color: rgba(0, 128, 0, 0.2);
            border: 1px solid #008000;
        }

        .wuxing-item.huo {
            background-color: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff0000;
        }

        .wuxing-item.tu {
            background-color: rgba(255, 165, 0, 0.2);
            border: 1px solid #ffa500;
        }

        .wuxing-item.jin {
            background-color: rgba(192, 192, 192, 0.2);
            border: 1px solid #c0c0c0;
        }

        .wuxing-item.shui {
            background-color: rgba(0, 0, 255, 0.2);
            border: 1px solid #0000ff;
        }

        .wuxing-item .name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .wuxing-item .value {
            font-size: 24px;
            font-weight: bold;
        }

        .wuxing-item .description {
            font-size: 14px;
            margin-top: 5px;
        }

        /* 选项卡样式 */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            margin: 20px 0;
            border-bottom: 1px solid #ccc;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ccc;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
            transition: background-color 0.3s;
        }

        .tab.active {
            background-color: #8b0000;
            color: white;
            border-color: #8b0000;
        }

        .tab-content {
            display: none;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.92);
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }

        .tab-content.active {
            display: block;
        }

        /* 十神表格样式 */
        .shishen-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .shishen-table th, .shishen-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        .shishen-table th {
            background-color: #8b0000;
            color: white;
        }

        .shishen-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* 卡片样式 */
        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-title {
            color: #8b0000;
            font-size: 20px;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        /* 大运流年样式 */
        .dayun-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .dayun-table th, .dayun-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        .dayun-table th {
            background-color: #8b0000;
            color: white;
        }

        .dayun-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .dayun-table .good {
            color: green;
            font-weight: bold;
        }

        .dayun-table .bad {
            color: red;
            font-weight: bold;
        }

        /* 六亲分析样式 */
        .liuqin-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .liuqin-item {
            background-color: #f8f4e9;
            border: 1px solid #d9c9a8;
            border-radius: 5px;
            padding: 15px;
        }

        .liuqin-item h4 {
            color: #8b0000;
            margin-bottom: 10px;
            font-size: 18px;
        }

        /* 人生阶段样式 */
        .life-stage {
            margin-bottom: 30px;
        }

        .life-stage-timeline {
            position: relative;
            margin: 20px 0;
            padding-left: 30px;
        }

        .life-stage-timeline:before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            height: 100%;
            width: 2px;
            background-color: #8b0000;
        }

        .life-stage-item {
            position: relative;
            margin-bottom: 20px;
        }

        .life-stage-item:before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #8b0000;
        }

        .life-stage-age {
            font-weight: bold;
            color: #8b0000;
        }

        /* 吉凶判断样式 */
        .jixiong-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .jixiong-item {
            background-color: #f8f4e9;
            border: 1px solid #d9c9a8;
            border-radius: 5px;
            padding: 15px;
        }

        .jixiong-item.ji {
            border-left: 5px solid green;
        }

        .jixiong-item.xiong {
            border-left: 5px solid red;
        }

        .jixiong-item h4 {
            margin-bottom: 10px;
        }

        .jixiong-item.ji h4 {
            color: green;
        }

        .jixiong-item.xiong h4 {
            color: red;
        }

        /* 化解建议样式 */
        .jiehua-list {
            list-style-type: none;
        }

        .jiehua-list li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
        }

        .jiehua-list li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: green;
            font-weight: bold;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .navbar .container {
                flex-direction: column;
            }

            .nav-links {
                margin-top: 15px;
            }

            .nav-links li {
                margin: 0 10px;
            }

            .bazi-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .wuxing-chart {
                flex-wrap: wrap;
            }

            .wuxing-item {
                width: 48%;
                margin-bottom: 10px;
            }

            .form-row {
                flex-direction: column;
            }

            .liuqin-grid, .jixiong-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .bazi-grid {
                grid-template-columns: 1fr;
            }

            .wuxing-item {
                width: 100%;
            }
        }

        /* 页脚样式 */
        footer {
            background-color: rgba(139, 0, 0, 0.9);
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
        }

        /* 加载动画 */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #8b0000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 提示框样式 */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* 图表容器 */
        .chart-container {
            width: 100%;
            height: 300px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <!-- 主要内容 -->
    <main>
        <div class="container">
            <h1>专业八字命理分析</h1>
            
            <!-- 八字输入区域 -->
            <div class="form-container">
                <h2>请输入你的出生信息</h2>
                <form id="bazi-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="gender">性别</label>
                            <select id="gender" name="gender">
                                <option value="male">男命</option>
                                <option value="female">女命</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="birthdate">出生日期（公历）</label>
                            <input type="date" id="birthdate" name="birthdate" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="hour">时辰</label>
                            <select id="hour" name="hour" required>
                                <option value="0">子时 (23:00-01:00)</option>
                                <option value="1">丑时 (01:00-03:00)</option>
                                <option value="2">寅时 (03:00-05:00)</option>
                                <option value="3">卯时 (05:00-07:00)</option>
                                <option value="4">辰时 (07:00-09:00)</option>
                                <option value="5">巳时 (09:00-11:00)</option>
                                <option value="6">午时 (11:00-13:00)</option>
                                <option value="7">未时 (13:00-15:00)</option>
                                <option value="8">申时 (15:00-17:00)</option>
                                <option value="9">酉时 (17:00-19:00)</option>
                                <option value="10">戌时 (19:00-21:00)</option>
                                <option value="11">亥时 (21:00-23:00)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 农历日期显示 -->
                    <div class="lunar-date-display" id="lunar-date-display" style="display:none;">
                        <h3>转换后的农历日期</h3>
                        <p id="lunar-date-text"></p>
                    </div>
                    
                    <div class="form-group">
                        <label for="location">出生地点（用于时区校正）</label>
                        <input type="text" id="location" name="location" placeholder="例如：北京市">
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn">生成命盘</button>
                        <button type="reset" class="btn btn-secondary">重置</button>
                    </div>
                </form>
            </div>
            
            <!-- 加载动画 -->
            <div class="loader" id="loader"></div>
            
            <!-- 农历日期显示 -->
            <div class="lunar-date-display" id="lunar-date-display" style="display:none;">
                <h3>转换后的农历日期</h3>
                <p id="lunar-date-text"></p>
            </div>
            
            <!-- 八字排盘结果 -->
            <div class="bazi-result" id="bazi-result">
                <h2>你的八字命盘</h2>
                <div class="bazi-grid">
                    <div class="bazi-column">
                        <h3>年柱</h3>
                        <div class="gan" id="year-gan">甲</div>
                        <div class="zhi" id="year-zhi">子</div>
                        <div id="year-desc">描述</div>
                    </div>
                    <div class="bazi-column">
                        <h3>月柱</h3>
                        <div class="gan" id="month-gan">乙</div>
                        <div class="zhi" id="month-zhi">丑</div>
                        <div id="month-desc">描述</div>
                    </div>
                    <div class="bazi-column">
                        <h3>日柱</h3>
                        <div class="gan" id="day-gan">丙</div>
                        <div class="zhi" id="day-zhi">寅</div>
                        <div id="day-desc">描述</div>
                    </div>
                    <div class="bazi-column">
                        <h3>时柱</h3>
                        <div class="gan" id="hour-gan">丁</div>
                        <div class="zhi" id="hour-zhi">卯</div>
                        <div id="hour-desc">描述</div>
                    </div>
                </div>
                
                <!-- 五行分析 -->
                <div class="wuxing-analysis">
                    <h2>五行分析</h2>
                    <div class="wuxing-chart">
                        <div class="wuxing-item mu">
                            <div class="name">木</div>
                            <div class="value" id="mu-value">2</div>
                            <div class="description" id="mu-desc">偏旺</div>
                        </div>
                        <div class="wuxing-item huo">
                            <div class="name">火</div>
                            <div class="value" id="huo-value">1</div>
                            <div class="description" id="huo-desc">平衡</div>
                        </div>
                        <div class="wuxing-item tu">
                            <div class="name">土</div>
                            <div class="value" id="tu-value">1</div>
                            <div class="description" id="tu-desc">平衡</div>
                        </div>
                        <div class="wuxing-item jin">
                            <div class="name">金</div>
                            <div class="value" id="jin-value">1</div>
                            <div class="description" id="jin-desc">偏弱</div>
                        </div>
                        <div class="wuxing-item shui">
                            <div class="name">水</div>
                            <div class="value" id="shui-value">3</div>
                            <div class="description" id="shui-desc">偏旺</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">五行分析结果</div>
                        <p id="wuxing-analysis-text">你的命盘中木和水偏旺，金偏弱。木旺之人性格刚直，有主见，但有时过于固执；水旺之人聪明机智，适应力强，但情绪波动较大。建议你多接触金属性的事物，如佩戴金属饰品，选择白色、金色的衣物，以平衡五行。</p>
                    </div>
                </div>
                
                <!-- 十神分析 -->
                <div class="shishen-analysis">
                    <h2>十神体系深度分析</h2>
                    <table class="shishen-table">
                        <thead>
                            <tr>
                                <th>十神</th>
                                <th>天干</th>
                                <th>地支</th>
                                <th>含义</th>
                                <th>六亲关系</th>
                                <th>旺衰影响</th>
                            </tr>
                        </thead>
                        <tbody id="shishen-tbody">
                            <tr>
                                <td>比肩</td>
                                <td>甲</td>
                                <td>-</td>
                                <td>代表兄弟姐妹、朋友、同事，与自身同性</td>
                                <td>兄弟、朋友</td>
                                <td>比肩旺者，自我意识强，有竞争心，但可能固执己见</td>
                            </tr>
                            <tr>
                                <td>劫财</td>
                                <td>-</td>
                                <td>子</td>
                                <td>代表异性朋友、竞争者，有争夺之意</td>
                                <td>父亲、异性朋友</td>
                                <td>劫财旺者，善于交际，但可能花钱大方，理财能力弱</td>
                            </tr>
                            <tr>
                                <td>食神</td>
                                <td>丙</td>
                                <td>-</td>
                                <td>代表才华、表达能力、口福</td>
                                <td>女儿、祖母</td>
                                <td>食神旺者，聪明多才，善于表达，但可能过于享乐</td>
                            </tr>
                            <tr>
                                <td>伤官</td>
                                <td>-</td>
                                <td>寅</td>
                                <td>代表创造力、艺术天赋，但也可能叛逆</td>
                                <td>儿子、祖父</td>
                                <td>伤官旺者，有创造力，但可能叛逆，不喜约束</td>
                            </tr>
                            <tr>
                                <td>偏财</td>
                                <td>丁</td>
                                <td>-</td>
                                <td>代表意外之财、投机之财</td>
                                <td>父亲、情人</td>
                                <td>偏财旺者，善于理财，有商业头脑，但可能感情复杂</td>
                            </tr>
                            <tr>
                                <td>正财</td>
                                <td>-</td>
                                <td>卯</td>
                                <td>代表正职收入、稳定财富</td>
                                <td>妻子、稳定收入</td>
                                <td>正财旺者，稳重踏实，有理财能力，但可能过于保守</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="card">
                        <div class="card-title">十神综合分析</div>
                        <p id="shishen-comprehensive">你的命盘中比肩、劫财较多，说明你性格中有较强的竞争意识和自我主张，同时善于交际，人缘较好。食神、伤官的存在表明你有创造力和艺术天赋，表达能力较强。偏财、正财的组合显示你在财务方面有一定能力，既有稳定收入，也有意外之财的机会。建议你在发挥创造力的同时，注意理财规划，避免因冲动而造成财务损失。</p>
                    </div>
                </div>
                
                <!-- 四柱详细分析 -->
                <div class="sizhu-analysis">
                    <h2>四柱详细分析</h2>
                    
                    <div class="card">
                        <div class="card-title">年柱分析</div>
                        <p id="year-column-analysis">你的年柱为甲子，甲木代表正直、刚强，子水代表智慧、灵活。年柱代表祖辈影响和童年运势，表明你可能出身于有一定文化底蕴的家庭，童年时期受到良好的教育和家庭熏陶。甲子组合显示你从小就表现出聪明才智和独立思考的能力，但可能有些固执。建议你珍惜家庭传承，同时保持开放的心态，接受新事物。</p>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">月柱分析</div>
                        <p id="month-column-analysis">你的月柱为乙丑，乙木代表柔和、适应，丑土代表稳重、踏实。月柱代表父母影响和少年运势，表明你的父母可能性格温和但做事踏实，对你的教育较为严格。乙丑组合显示你在少年时期性格较为内敛，学习能力强，但可能有些缺乏自信。建议你在这个阶段多参与社交活动，增强自信心，为未来的发展打下基础。</p>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">日柱分析</div>
                        <p id="day-column-analysis">你的日柱为丙寅，丙火代表热情、活力，寅木代表生机、成长。日柱代表自身性格和中年运势，表明你性格热情开朗，充满活力，有较强的领导能力和创造力。丙寅组合显示你在中年时期事业有望取得较大发展，但也可能面临一些挑战和压力。建议你保持积极乐观的心态，同时注意劳逸结合，避免过度劳累。</p>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">时柱分析</div>
                        <p id="hour-column-analysis">你的时柱为丁卯，丁火代表温和、细腻，卯木代表仁慈、和谐。时柱代表晚年生活和后代情况，表明你晚年生活较为安稳，性格更加温和细腻，与子女关系融洽。丁卯组合显示你可能有较好的晚年运势，子女孝顺，家庭和睦。建议你在年轻时就为晚年生活做好规划，注重家庭关系的维护，为晚年幸福打下基础。</p>
                    </div>
                </div>
                
                <!-- 大运流年分析 -->
                <div class="dayun-analysis">
                    <h2>大运流年分析</h2>
                    <div class="card">
                        <div class="card-title">当前大运</div>
                        <p id="current-dayun">你当前的大运为戊辰（2020-2029年），戊土代表稳重、踏实，辰土代表包容、蓄藏。这十年是你事业发展的关键期，戊土生金，对你的命局有平衡作用，有利于事业稳定和财务积累。但辰土与你的日柱丙寅相克，可能会遇到一些挑战和阻力。建议你在这十年保持稳健的作风，避免冒进，同时抓住机遇，为未来的发展打下基础。</p>
                    </div>
                    
                    <table class="dayun-table">
                        <thead>
                            <tr>
                                <th>大运</th>
                                <th>时间</th>
                                <th>天干</th>
                                <th>地支</th>
                                <th>吉凶</th>
                                <th>主要影响</th>
                            </tr>
                        </thead>
                        <tbody id="dayun-tbody">
                            <tr>
                                <td>第一运</td>
                                <td>1990-1999</td>
                                <td>庚</td>
                                <td>午</td>
                                <td class="good">吉</td>
                                <td>学业顺利，有贵人相助</td>
                            </tr>
                            <tr>
                                <td>第二运</td>
                                <td>2000-2009</td>
                                <td>辛</td>
                                <td>未</td>
                                <td class="bad">凶</td>
                                <td>事业受阻，需谨慎决策</td>
                            </tr>
                            <tr>
                                <td>第三运</td>
                                <td>2010-2019</td>
                                <td>壬</td>
                                <td>申</td>
                                <td class="good">吉</td>
                                <td>事业发展，财运亨通</td>
                            </tr>
                            <tr>
                                <td>第四运</td>
                                <td>2020-2029</td>
                                <td>戊</td>
                                <td>辰</td>
                                <td class="good">吉</td>
                                <td>事业稳定，家庭和睦</td>
                            </tr>
                            <tr>
                                <td>第五运</td>
                                <td>2030-2039</td>
                                <td>己</td>
                                <td>巳</td>
                                <td class="bad">凶</td>
                                <td>健康需注意，防范风险</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="card">
                        <div class="card-title">流年预测</div>
                        <p id="liunian-forecast">2025年乙巳年，乙木与你的日干丙火相生，巳火与你的日支寅木相生，整体运势较为顺利。事业上可能有新的机遇，财运也有所提升。但巳火过旺，需注意健康问题，特别是心脏和血液循环方面。建议你抓住机遇，同时注意休息，保持身心健康。</p>
                    </div>
                </div>
                
                <!-- 六亲关系深度分析 -->
                <div class="liuqin-analysis">
                    <h2>六亲关系深度分析</h2>
                    <div class="liuqin-grid">
                        <div class="liuqin-item">
                            <h4>父母运</h4>
                            <p>你的年柱甲子，甲木为偏印，子水为正印，表明你与父母关系较为融洽，特别是与母亲关系亲密。父母可能对你的教育和成长投入较多，你也受益于父母的指导和支持。建议你多关心父母的健康，特别是父亲的健康，因为命局中金元素较弱，可能与父亲的健康有关。</p>
                        </div>
                        <div class="liuqin-item">
                            <h4>兄弟姐妹</h4>
                            <p>你的命局中比肩、劫财较多，表明你可能有兄弟姐妹，或者与朋友关系如同兄弟姐妹。比肩代表同性兄弟姐妹或朋友，劫财代表异性兄弟姐妹或朋友。你与兄弟姐妹之间可能存在一定的竞争关系，但总体上是互相支持的。建议你在处理与兄弟姐妹的关系时，多些包容和理解，避免因小事而产生矛盾。</p>
                        </div>
                        <div class="liuqin-item">
                            <h4>婚姻感情</h4>
                            <p>你的日柱丙寅，丙火为日主，寅木为食神，表明你在感情方面较为热情，有创造力，但也可能有些理想化。命局中正财、偏财都有，表明你在感情方面可能有一定的复杂性，既有稳定的感情关系，也可能有一些外遇的机会。建议你在感情中保持真诚和专一，避免因冲动而做出决定，同时多与伴侣沟通，增进理解。</p>
                        </div>
                        <div class="liuqin-item">
                            <h4>子女运</h4>
                            <p>你的时柱丁卯，丁火为食神，卯木为伤官，表明你与子女关系较为融洽，子女可能聪明有才华。食神代表女儿，伤官代表儿子，表明你可能有子女，且子女在艺术、创造方面有一定天赋。建议你在子女教育方面多给予支持和鼓励，同时注意培养他们的责任感和独立性，为他们的未来发展打下良好基础。</p>
                        </div>
                    </div>
                </div>
                
                <!-- 人生阶段预测 -->
                <div class="life-stage-analysis">
                    <h2>人生阶段预测</h2>
                    
                    <div class="life-stage">
                        <h3>求学阶段</h3>
                        <div class="life-stage-timeline">
                            <div class="life-stage-item">
                                <div class="life-stage-age">6-12岁（小学阶段）</div>
                                <p>你在这个阶段学习能力较强，特别是语文、历史等文科方面表现突出。但可能有些好动，注意力不够集中。建议家长多引导，培养良好的学习习惯。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">12-18岁（中学阶段）</div>
                                <p>这个阶段你的思维能力有所提升，开始形成自己的见解。但可能有些叛逆，不喜欢被约束。建议你在这个阶段多参与集体活动，增强团队合作意识。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">18-24岁（大学阶段）</div>
                                <p>大学阶段是你发展的重要时期，你在专业学习上有较好的表现，特别是在创意、设计等方面有天赋。建议你在这个阶段多参与社会实践，积累经验，为未来的职业发展打下基础。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="life-stage">
                        <h3>事业阶段</h3>
                        <div class="life-stage-timeline">
                            <div class="life-stage-item">
                                <div class="life-stage-age">24-30岁（事业起步期）</div>
                                <p>这个阶段你开始步入职场，可能会经历一些尝试和调整。你的创造力和适应能力是优势，但可能缺乏经验。建议你在这个阶段多学习，积累经验，同时保持开放的心态，接受挑战。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">30-40岁（事业发展期）</div>
                                <p>这是你事业发展的关键期，你的领导能力和创造力将得到充分发挥。你可能在这个阶段取得一定的成就，但也面临较大的压力和挑战。建议你保持稳健的作风，同时抓住机遇，为未来的发展打下基础。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">40-50岁（事业成熟期）</div>
                                <p>这个阶段你的事业趋于稳定，可能已经取得一定的成就和地位。你的经验和智慧是宝贵的财富，但也可能面临一些新的挑战和变化。建议你保持学习的态度，适应时代的变化，同时注重团队建设，培养接班人。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="life-stage">
                        <h3>婚姻阶段</h3>
                        <div class="life-stage-timeline">
                            <div class="life-stage-item">
                                <div class="life-stage-age">25-30岁（婚姻起步期）</div>
                                <p>这个阶段你可能开始考虑婚姻问题，或者已经步入婚姻。你的热情和创造力是优势，但也可能有些理想化。建议你在婚姻中保持真诚和专一，多与伴侣沟通，增进理解。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">30-40岁（婚姻稳定期）</div>
                                <p>这个阶段你的婚姻趋于稳定，可能已经育有子女。你的责任感和家庭观念是优势，但也可能面临一些家庭和事业的平衡问题。建议你在家庭和事业之间找到平衡点，同时注重夫妻关系的维护，增进感情。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">40-50岁（婚姻成熟期）</div>
                                <p>这个阶段你的婚姻已经相当成熟，你和伴侣之间可能已经形成了深厚的感情和默契。你的智慧和经验是宝贵的财富，但也可能面临一些新的挑战和变化。建议你保持开放的心态，接受变化，同时注重家庭生活的质量，增进幸福感。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="life-stage">
                        <h3>健康阶段</h3>
                        <div class="life-stage-timeline">
                            <div class="life-stage-item">
                                <div class="life-stage-age">20-35岁（健康基础期）</div>
                                <p>这个阶段你的身体较为健康，精力充沛，但也可能因为工作压力和生活不规律而出现一些健康问题。建议你在这个阶段养成良好的生活习惯，注意饮食和运动，为未来的健康打下基础。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">35-50岁（健康关键期）</div>
                                <p>这个阶段是你健康的关键期，可能会出现一些健康问题，特别是与压力相关的疾病。你的命局中木火较旺，需注意心脏、血液循环等方面的问题。建议你定期体检，保持健康的生活方式，同时学会调节情绪，减轻压力。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">50岁以上（健康维护期）</div>
                                <p>这个阶段你的健康需要更多的关注和维护，可能会出现一些与年龄相关的健康问题。你的命局中金元素较弱，需注意呼吸系统、骨骼等方面的问题。建议你保持积极乐观的心态，适当运动，合理饮食，同时定期体检，及时发现和处理健康问题。</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="life-stage">
                        <h3>晚年阶段</h3>
                        <div class="life-stage-timeline">
                            <div class="life-stage-item">
                                <div class="life-stage-age">60-70岁（晚年适应期）</div>
                                <p>这个阶段你开始适应晚年生活，可能已经退休，有更多的时间陪伴家人和追求自己的兴趣爱好。你的时柱丁卯显示晚年生活较为安稳，与子女关系融洽。建议你保持积极的生活态度，参与一些有益的活动，同时注意健康保养。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">70-80岁（晚年稳定期）</div>
                                <p>这个阶段你的晚年生活已经相当稳定，可能已经形成了自己的生活方式和社交圈。你的智慧和经验是宝贵的财富，但也可能面临一些健康和生活的挑战。建议你保持开放的心态，接受变化，同时注重生活质量的提升，增进幸福感。</p>
                            </div>
                            <div class="life-stage-item">
                                <div class="life-stage-age">80岁以上（晚年圆满期）</div>
                                <p>这个阶段你已经进入高龄，可能需要更多的照顾和关爱。你的命局显示你可能有较好的晚年运势，子女孝顺，家庭和睦。建议你保持平和的心态，享受天伦之乐，同时注重健康保养，安度晚年。</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 吉凶判断 -->
                <div class="jixiong-analysis">
                    <h2>吉凶判断</h2>
                    <div class="jixiong-grid">
                        <div class="jixiong-item ji">
                            <h4>吉星：天乙贵人</h4>
                            <p>你的命局中有天乙贵人，这是最吉利的神煞之一，代表有贵人相助，逢凶化吉。在你遇到困难和挑战时，可能会得到他人的帮助和支持，使你能够顺利度过难关。建议你珍惜身边的贵人，同时也要学会成为他人的贵人，积累福报。</p>
                        </div>
                        <div class="jixiong-item ji">
                            <h4>吉星：文昌贵人</h4>
                            <p>你的命局中有文昌贵人，这代表你有较好的学习能力和文学才华，在学业和事业上有所成就。文昌贵人也有助于提升你的智慧和能力，使你在竞争中占据优势。建议你充分发挥自己的才华，不断学习和提升自己，为未来的发展打下基础。</p>
                        </div>
                        <div class="jixiong-item xiong">
                            <h4>凶星：孤辰寡宿</h4>
                            <p>你的命局中有孤辰寡宿，这代表你可能在人际关系方面有些孤独，或者与亲人关系不够亲密。这可能会影响你的情感生活和社交圈，使你感到孤独和不被理解。建议你主动参与社交活动，多与他人交流，增进与亲人的感情，避免孤独感的产生。</p>
                        </div>
                        <div class="jixiong-item xiong">
                            <h4>凶星：劫煞</h4>
                            <p>你的命局中有劫煞，这代表你可能会遇到一些意外损失或者被他人欺骗的情况。这可能会影响你的财务状况和安全感，使你感到不安和担忧。建议你在财务方面保持谨慎，避免冒险投资，同时增强自己的防范意识，避免被骗。</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">用神忌神分析</div>
                        <p id="yongshen-analysis">用神是你命局中对你有利的五行，宜多接触相关事物；忌神是你命局中对你不利的五行，宜少接触或通过用神来化解。</p>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">命理组合分析</div>
                        <p id="mingli-combination">你的命局中木火较旺，金水较弱，形成了一种"木火通明"的组合。这种组合的人通常聪明有才华，有较强的创造力和领导能力，但也可能有些急躁和冲动。木火通明的人适合从事与创意、教育、艺术等相关的工作，在这些领域有较大的发展潜力。但需要注意的是，木火过旺可能会消耗金水，导致健康和财务方面的问题。建议你在发挥自己优势的同时，注意平衡五行，特别是增强金水元素，以保持身心的健康和平衡。</p>
                    </div>
                </div>
                
                <!-- 化解建议 -->
                <div class="jiehua-advice">
                    <h2>化解建议</h2>
                    <div class="card">
                        <div class="card-title">五行平衡建议</div>
                        <ul class="jiehua-list">
                            <li>增强金元素：佩戴金属饰品，如金、银、铂金等；选择白色、金色的衣物；多接触金属物品，如铜器、铁器等。</li>
                            <li>增强水元素：多饮水，保持身体水分；选择黑色、蓝色的衣物；多接触水域，如湖泊、河流等；在家中摆放鱼缸或水景。</li>
                            <li>减弱木元素：减少绿色植物的数量；避免过多使用木质家具；减少户外活动，特别是在森林、公园等木气旺盛的地方。</li>
                            <li>减弱火元素：避免过多使用红色、紫色的物品；减少阳光直射的时间；避免辛辣刺激的食物；保持情绪稳定，避免急躁和冲动。</li>
                        </ul>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">风水布局建议</div>
                        <ul class="jiehua-list">
                            <li>住宅方位：选择坐北朝南或坐西朝东的住宅，有利于金水元素的增强。</li>
                            <li>卧室布局：床头朝向北方或西方，有利于休息和健康；避免床头朝向南方或东方，以免增强火木元素。</li>
                            <li>办公环境：办公桌朝向北方或西方，有利于事业发展和财运；在办公桌上摆放金属物品，如铜制笔筒、金属摆件等。</li>
                            <li>财位布局：家中的财位在西北方，可在此处摆放金属物品或水景，以增强财运；避免在此处放置红色物品或过多植物。</li>
                        </ul>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">个性化风水建议（基于用神忌神）</div>
                        <div id="fengshui-advice">
                            <p>根据您的八字用神忌神分析，系统将为您提供个性化的风水布局建议。</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">生活建议</div>
                        <ul class="jiehua-list">
                            <li>职业选择：适合从事与金、水相关的行业，如金融、贸易、航运、水利等；避免从事与木、火相关的行业，如林业、餐饮、娱乐等。</li>
                            <li>人际交往：多与五行属金、水的人交往，如属猴、鸡、鼠、猪的人；避免与五行属木、火的人过多交往，如属虎、兔、蛇、马的人。</li>
                            <li>健康保养：注意呼吸系统、泌尿系统的健康；定期体检，特别是心脏、肾脏方面的检查；保持良好的作息习惯，避免熬夜。</li>
                            <li>心理调节：学会控制情绪，避免急躁和冲动；多参与一些平静的活动，如冥想、瑜伽等；保持积极乐观的心态，避免过度焦虑和压力。</li>
                        </ul>
                    </div>
                </div>
                
                <div class="form-group">
                    <button class="btn" id="save-report">保存报告</button>
                    <button class="btn btn-secondary" id="share-report">分享报告</button>
                    <button class="btn btn-secondary" id="new-analysis">重新分析</button>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer>
        <div class="container">
            <p>Copyright © 2025 吴伟_Leo. 保留所有权利.</p>
            <p>本网站仅供娱乐参考，不作为人生决策依据。请理性对待命理分析结果。</p>
        </div>
    </footer>

    <script src="../mixin/lunar.js"></script>
    <script>
        // 天干地支数组
        const tianGan = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
        const diZhi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
        
        // 五行属性
        const wuxing = {
            '甲': '木', '乙': '木',
            '丙': '火', '丁': '火',
            '戊': '土', '己': '土',
            '庚': '金', '辛': '金',
            '壬': '水', '癸': '水',
            '子': '水', '亥': '水',
            '寅': '木', '卯': '木',
            '巳': '火', '午': '火',
            '申': '金', '酉': '金',
            '辰': '土', '戌': '土', '丑': '土', '未': '土'
        };
        
        // 十神关系
        const shishen = {
            '甲': { '甲': '比肩', '乙': '劫财', '丙': '食神', '丁': '伤官', '戊': '偏财', '己': '正财', '庚': '七杀', '辛': '正官', '壬': '偏印', '癸': '正印' },
            '乙': { '甲': '劫财', '乙': '比肩', '丙': '伤官', '丁': '食神', '戊': '正财', '己': '偏财', '庚': '正官', '辛': '七杀', '壬': '正印', '癸': '偏印' },
            '丙': { '甲': '偏印', '乙': '正印', '丙': '比肩', '丁': '劫财', '戊': '食神', '己': '伤官', '庚': '偏财', '辛': '正财', '壬': '七杀', '癸': '正官' },
            '丁': { '甲': '正印', '乙': '偏印', '丙': '劫财', '丁': '比肩', '戊': '伤官', '己': '食神', '庚': '正财', '辛': '偏财', '壬': '正官', '癸': '七杀' },
            '戊': { '甲': '七杀', '乙': '正官', '丙': '偏印', '丁': '正印', '戊': '比肩', '己': '劫财', '庚': '食神', '辛': '伤官', '壬': '偏财', '癸': '正财' },
            '己': { '甲': '正官', '乙': '七杀', '丙': '正印', '丁': '偏印', '戊': '劫财', '己': '比肩', '庚': '伤官', '辛': '食神', '壬': '正财', '癸': '偏财' },
            '庚': { '甲': '偏财', '乙': '正财', '丙': '七杀', '丁': '正官', '戊': '偏印', '己': '正印', '庚': '比肩', '辛': '劫财', '壬': '食神', '癸': '伤官' },
            '辛': { '甲': '正财', '乙': '偏财', '丙': '正官', '丁': '七杀', '戊': '正印', '己': '偏印', '庚': '劫财', '辛': '比肩', '壬': '伤官', '癸': '食神' },
            '壬': { '甲': '食神', '乙': '伤官', '丙': '偏财', '丁': '正财', '戊': '七杀', '己': '正官', '庚': '偏印', '辛': '正印', '壬': '比肩', '癸': '劫财' },
            '癸': { '甲': '伤官', '乙': '食神', '丙': '正财', '丁': '偏财', '戊': '正官', '己': '七杀', '庚': '正印', '辛': '偏印', '壬': '劫财', '癸': '比肩' }
        };
        
        // 十神六亲关系
        const shishenLiuqin = {
            '比肩': '兄弟、朋友',
            '劫财': '父亲、异性朋友',
            '食神': '女儿、祖母',
            '伤官': '儿子、祖父',
            '偏财': '父亲、情人',
            '正财': '妻子、稳定收入',
            '七杀': '小人、压力',
            '正官': '女儿、丈夫、秩序',
            '偏印': '庶母、特殊才能',
            '正印': '母亲、智慧、权威'
        };
        
        // 十神旺衰影响
        const shishenWangshuai = {
            '比肩': '比肩旺者，自我意识强，有竞争心，但可能固执己见',
            '劫财': '劫财旺者，善于交际，但可能花钱大方，理财能力弱',
            '食神': '食神旺者，聪明多才，善于表达，但可能过于享乐',
            '伤官': '伤官旺者，有创造力，但可能叛逆，不喜约束',
            '偏财': '偏财旺者，善于理财，有商业头脑，但可能感情复杂',
            '正财': '正财旺者，稳重踏实，有理财能力，但可能过于保守',
            '七杀': '七杀旺者，有魄力，但可能冲动，易招是非',
            '正官': '正官旺者，有责任心，守规矩，但可能过于拘谨',
            '偏印': '偏印旺者，有特殊才能，但可能孤僻，不喜交际',
            '正印': '正印旺者，有学识，有贵人相助，但可能依赖性强'
        };
        
        // 节气数据（简化版）
        const jieqi = {
            1: { start: 4, name: '小寒' }, 2: { start: 4, name: '立春' }, 3: { start: 5, name: '惊蛰' },
            4: { start: 4, name: '清明' }, 5: { start: 5, name: '立夏' }, 6: { start: 5, name: '芒种' },
            7: { start: 7, name: '小暑' }, 8: { start: 7, name: '立秋' }, 9: { start: 7, name: '白露' },
            10: { start: 8, name: '寒露' }, 11: { start: 7, name: '立冬' }, 12: { start: 7, name: '大雪' }
        };
        
        // 大运数据（简化版）
        const dayunData = [
            { name: '庚午', start: 1990, end: 1999, gan: '庚', zhi: '午', jixiong: '吉', yingxiang: '学业顺利，有贵人相助' },
            { name: '辛未', start: 2000, end: 2009, gan: '辛', zhi: '未', jixiong: '凶', yingxiang: '事业受阻，需谨慎决策' },
            { name: '壬申', start: 2010, end: 2019, gan: '壬', zhi: '申', jixiong: '吉', yingxiang: '事业发展，财运亨通' },
            { name: '戊辰', start: 2020, end: 2029, gan: '戊', zhi: '辰', jixiong: '吉', yingxiang: '事业稳定，家庭和睦' },
            { name: '己巳', start: 2030, end: 2039, gan: '己', zhi: '巳', jixiong: '凶', yingxiang: '健康需注意，防范风险' }
        ];
        
        // 计算年柱
        function getYearColumn(year) {
            const offset = year - 1900 + 36;
            const ganIndex = offset % 10;
            const zhiIndex = offset % 12;
            return {
                gan: tianGan[ganIndex],
                zhi: diZhi[zhiIndex]
            };
        }
        
        // 计算月柱（简化版）
        function getMonthColumn(year, month, day) {
            // 根据年份和月份确定月柱
            const yearColumn = getYearColumn(year);
            const yearGanIndex = tianGan.indexOf(yearColumn.gan);
            
            // 甲己之年丙作首，乙庚之岁戊为头
            let monthGanBase;
            if (yearGanIndex === 0 || yearGanIndex === 5) { // 甲或己年
                monthGanBase = 2; // 丙
            } else if (yearGanIndex === 1 || yearGanIndex === 6) { // 乙或庚年
                monthGanBase = 4; // 戊
            } else if (yearGanIndex === 2 || yearGanIndex === 7) { // 丙或辛年
                monthGanBase = 6; // 庚
            } else if (yearGanIndex === 3 || yearGanIndex === 8) { // 丁或壬年
                monthGanBase = 8; // 壬
            } else { // 戊或癸年
                monthGanBase = 0; // 甲
            }
            
            // 计算月干
            const monthGanIndex = (monthGanBase + month - 1) % 10;
            
            // 计算月支（寅为正月，卯为二月，以此类推）
            const monthZhiIndex = (month + 1) % 12;
            
            // 检查是否过了节气
            const jieqiDay = jieqi[month].start;
            if (day < jieqiDay) {
                // 如果没过节气，则用上个月的月柱
                const prevMonthGanIndex = (monthGanIndex + 9) % 10;
                const prevMonthZhiIndex = (monthZhiIndex + 11) % 12;
                return {
                    gan: tianGan[prevMonthGanIndex],
                    zhi: diZhi[prevMonthZhiIndex]
                };
            }
            
            return {
                gan: tianGan[monthGanIndex],
                zhi: diZhi[monthZhiIndex]
            };
        }
        
        // 计算日柱（简化版）
        function getDayColumn(year, month, day) {
            // 使用简化的算法计算日柱
            const baseDate = new Date(1900, 0, 31); // 1900年1月31日为庚子日
            const targetDate = new Date(year, month - 1, day);
            const diffDays = Math.floor((targetDate - baseDate) / (1000 * 60 * 60 * 24));
            
            const ganIndex = diffDays % 10;
            const zhiIndex = diffDays % 12;
            
            return {
                gan: tianGan[ganIndex],
                zhi: diZhi[zhiIndex]
            };
        }
        
        // 计算时柱
        function getHourColumn(dayGan, hour) {
            // 根据日干和时辰确定时柱
            const dayGanIndex = tianGan.indexOf(dayGan);
            
            // 甲己还生甲，乙庚丙作初，丙辛从戊起，丁壬庚子居，戊癸何方发，壬子是真途
            let hourGanBase;
            if (dayGanIndex === 0 || dayGanIndex === 5) { // 甲或己日
                hourGanBase = 0; // 甲
            } else if (dayGanIndex === 1 || dayGanIndex === 6) { // 乙或庚日
                hourGanBase = 2; // 丙
            } else if (dayGanIndex === 2 || dayGanIndex === 7) { // 丙或辛日
                hourGanBase = 4; // 戊
            } else if (dayGanIndex === 3 || dayGanIndex === 8) { // 丁或壬日
                hourGanBase = 6; // 庚
            } else { // 戊或癸日
                hourGanBase = 8; // 壬
            }
            
            // 计算时干
            const hourGanIndex = (hourGanBase + hour) % 10;
            
            // 计算时支
            const hourZhiIndex = hour;
            
            return {
                gan: tianGan[hourGanIndex],
                zhi: diZhi[hourZhiIndex]
            };
        }
        
        // 计算五行分布
        function calculateWuxingDistribution(bazi) {
            const distribution = {
                '木': 0, '火': 0, '土': 0, '金': 0, '水': 0
            };
            
            // 统计四柱中的五行
            Object.values(bazi).forEach(column => {
                distribution[wuxing[column.gan]]++;
                distribution[wuxing[column.zhi]]++;
            });
            
            return distribution;
        }
        
        // 判断五行旺衰
        function judgeWuxingStrength(distribution) {
            const total = Object.values(distribution).reduce((sum, count) => sum + count, 0);
            const average = total / 5;
            
            const strength = {};
            Object.keys(distribution).forEach(element => {
                const count = distribution[element];
                if (count > average + 1) {
                    strength[element] = '偏旺';
                } else if (count < average - 1) {
                    strength[element] = '偏弱';
                } else {
                    strength[element] = '平衡';
                }
            });
            
            return strength;
        }
        
        // 生成十神表格
        function generateShishenTable(bazi) {
            const dayGan = bazi.day.gan;
            const tbody = document.getElementById('shishen-tbody');
            tbody.innerHTML = '';
            
            // 年柱
            const yearShishenGan = shishen[dayGan][bazi.year.gan];
            const yearShishenZhi = shishen[dayGan][bazi.year.zhi] || '-';
            
            // 月柱
            const monthShishenGan = shishen[dayGan][bazi.month.gan];
            const monthShishenZhi = shishen[dayGan][bazi.month.zhi] || '-';
            
            // 日柱
            const dayShishenGan = '日主';
            const dayShishenZhi = shishen[dayGan][bazi.day.zhi] || '-';
            
            // 时柱
            const hourShishenGan = shishen[dayGan][bazi.hour.gan];
            const hourShishenZhi = shishen[dayGan][bazi.hour.zhi] || '-';
            
            // 添加行
            const shishenData = [
                { name: yearShishenGan, gan: bazi.year.gan, zhi: '-', liuqin: shishenLiuqin[yearShishenGan] || '', wangshuai: shishenWangshuai[yearShishenGan] || '' },
                { name: yearShishenZhi, gan: '-', zhi: bazi.year.zhi, liuqin: shishenLiuqin[yearShishenZhi] || '', wangshuai: shishenWangshuai[yearShishenZhi] || '' },
                { name: monthShishenGan, gan: bazi.month.gan, zhi: '-', liuqin: shishenLiuqin[monthShishenGan] || '', wangshuai: shishenWangshuai[monthShishenGan] || '' },
                { name: monthShishenZhi, gan: '-', zhi: bazi.month.zhi, liuqin: shishenLiuqin[monthShishenZhi] || '', wangshuai: shishenWangshuai[monthShishenZhi] || '' },
                { name: dayShishenGan, gan: bazi.day.gan, zhi: '-', liuqin: '命主本人', wangshuai: '日主代表命主本人' },
                { name: dayShishenZhi, gan: '-', zhi: bazi.day.zhi, liuqin: shishenLiuqin[dayShishenZhi] || '', wangshuai: shishenWangshuai[dayShishenZhi] || '' },
                { name: hourShishenGan, gan: bazi.hour.gan, zhi: '-', liuqin: shishenLiuqin[hourShishenGan] || '', wangshuai: shishenWangshuai[hourShishenGan] || '' },
                { name: hourShishenZhi, gan: '-', zhi: bazi.hour.zhi, liuqin: shishenLiuqin[hourShishenZhi] || '', wangshuai: shishenWangshuai[hourShishenZhi] || '' }
            ];
            
            // 过滤掉空值
            const filteredData = shishenData.filter(item => item.gan !== '-' || item.zhi !== '-');
            
            // 添加行到表格
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.gan}</td>
                    <td>${item.zhi}</td>
                    <td>${getShishenMeaning(item.name)}</td>
                    <td>${item.liuqin}</td>
                    <td>${item.wangshuai}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // 获取十神含义
        function getShishenMeaning(shishen) {
            const meanings = {
                '比肩': '代表兄弟姐妹、朋友、同事，与自身同性',
                '劫财': '代表异性朋友、竞争者，有争夺之意',
                '食神': '代表才华、表达能力、口福',
                '伤官': '代表创造力、艺术天赋，但也可能叛逆',
                '偏财': '代表意外之财、投机之财',
                '正财': '代表正职收入、稳定财富',
                '七杀': '代表压力、挑战、权威',
                '正官': '代表地位、纪律、约束',
                '偏印': '代表特殊才能、直觉、灵感',
                '正印': '代表学识、贵人、母亲'
            };
            return meanings[shishen] || '';
        }
        
        // 生成五行分析文本
        function generateWuxingAnalysisText(distribution, strength) {
            let analysisText = '你的命盘中';
            const strongElements = [];
            const weakElements = [];
            
            Object.keys(strength).forEach(element => {
                if (strength[element] === '偏旺') {
                    strongElements.push(element);
                } else if (strength[element] === '偏弱') {
                    weakElements.push(element);
                }
            });
            
            if (strongElements.length > 0) {
                analysisText += strongElements.join('、') + '偏旺';
            }
            
            if (weakElements.length > 0) {
                if (strongElements.length > 0) {
                    analysisText += '，';
                }
                analysisText += weakElements.join('、') + '偏弱';
            }
            
            // 添加五行特性描述
            const elementDescriptions = {
                '木': '木旺之人性格刚直，有主见，但有时过于固执',
                '火': '火旺之人热情活泼，有创造力，但有时过于急躁',
                '土': '土旺之人稳重踏实，有责任心，但有时过于保守',
                '金': '金旺之人果断坚毅，有正义感，但有时过于严厉',
                '水': '水旺之人聪明机智，适应力强，但情绪波动较大'
            };
            
            strongElements.forEach(element => {
                analysisText += '；' + elementDescriptions[element];
            });
            
            // 添加建议
            analysisText += '。建议你';
            
            if (weakElements.length > 0) {
                const elementAdvices = {
                    '木': '多接触木属性的事物，如植物、木质家具，选择绿色、青色的衣物',
                    '火': '多接触火属性的事物，如阳光、照明设备，选择红色、紫色的衣物',
                    '土': '多接触土属性的事物，如陶瓷、玉石，选择黄色、棕色的衣物',
                    '金': '多接触金属性的事物，如金属饰品、白色物品，选择白色、金色的衣物',
                    '水': '多接触水属性的事物，如水域、蓝色物品，选择黑色、蓝色的衣物'
                };
                
                const advices = weakElements.map(element => elementAdvices[element]).join('，');
                analysisText += advices;
            }
            
            analysisText += '，以平衡五行。';
            
            return analysisText;
        }
        
        // 生成十神综合分析
        function generateShishenComprehensiveAnalysis(bazi) {
            const dayGan = bazi.day.gan;
            let analysisText = '你的命盘中';
            
            // 统计十神数量
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen && ganShishen !== '日主') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen && zhiShishen !== '日主') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            // 分析主要十神
            const mainShishen = Object.keys(shishenCount).filter(key => shishenCount[key] > 1);
            
            if (mainShishen.length > 0) {
                analysisText += mainShishen.join('、') + '较多，';
                
                // 添加十神特性描述
                const shishenCharacteristics = {
                    '比肩': '表明你性格中有较强的竞争意识和自我主张',
                    '劫财': '表明你善于交际，人缘较好',
                    '食神': '表明你有创造力和艺术天赋，表达能力较强',
                    '伤官': '表明你有创造力，但可能叛逆，不喜约束',
                    '偏财': '表明你在财务方面有一定能力，有商业头脑',
                    '正财': '表明你稳重踏实，有理财能力',
                    '七杀': '表明你有魄力和决断力，但可能冲动',
                    '正官': '表明你有责任心，守规矩',
                    '偏印': '表明你有特殊才能，直觉敏锐',
                    '正印': '表明你有学识，有贵人相助'
                };
                
                mainShishen.forEach(shishen => {
                    analysisText += shishenCharacteristics[shishen] + '；';
                });
            }
            
            // 添加建议
            analysisText += '建议你在发挥自身优势的同时，注意平衡各方面的发展，避免因过于强调某一特质而导致失衡。';
            
            return analysisText;
        }
        
        // 生成四柱分析
        function generateSizhuAnalysis(bazi) {
            // 年柱分析
            const yearAnalysis = `你的年柱为${bazi.year.gan}${bazi.year.zhi}，${wuxing[bazi.year.gan]}代表${getElementCharacter(wuxing[bazi.year.gan])}，${wuxing[bazi.year.zhi]}代表${getElementCharacter(wuxing[bazi.year.zhi])}。年柱代表祖辈影响和童年运势，表明你可能出身于${getFamilyBackground(bazi.year)}的家庭，童年时期${getChildhoodExperience(bazi.year)}。${bazi.year.gan}${bazi.year.zhi}组合显示你从小就表现出${getEarlyCharacter(bazi.year)}，但可能${getEarlyWeakness(bazi.year)}。建议你珍惜家庭传承，同时保持开放的心态，接受新事物。`;
            
            // 月柱分析
            const monthAnalysis = `你的月柱为${bazi.month.gan}${bazi.month.zhi}，${wuxing[bazi.month.gan]}代表${getElementCharacter(wuxing[bazi.month.gan])}，${wuxing[bazi.month.zhi]}代表${getElementCharacter(wuxing[bazi.month.zhi])}。月柱代表父母影响和少年运势，表明你的父母可能${getParentCharacter(bazi.month)}，对你的教育${getParentEducation(bazi.month)}。${bazi.month.gan}${bazi.month.zhi}组合显示你在少年时期${getYouthCharacter(bazi.month)}，但可能${getYouthWeakness(bazi.month)}。建议你在这个阶段多参与社交活动，增强自信心，为未来的发展打下基础。`;
            
            // 日柱分析
            const dayAnalysis = `你的日柱为${bazi.day.gan}${bazi.day.zhi}，${wuxing[bazi.day.gan]}代表${getElementCharacter(wuxing[bazi.day.gan])}，${wuxing[bazi.day.zhi]}代表${getElementCharacter(wuxing[bazi.day.zhi])}。日柱代表自身性格和中年运势，表明你性格${getAdultCharacter(bazi.day)}，有${getAdultStrength(bazi.day)}。${bazi.day.gan}${bazi.day.zhi}组合显示你在中年时期${getAdultCareer(bazi.day)}，但也可能${getAdultChallenge(bazi.day)}。建议你保持积极乐观的心态，同时注意劳逸结合，避免过度劳累。`;
            
            // 时柱分析
            const hourAnalysis = `你的时柱为${bazi.hour.gan}${bazi.hour.zhi}，${wuxing[bazi.hour.gan]}代表${getElementCharacter(wuxing[bazi.hour.gan])}，${wuxing[bazi.hour.zhi]}代表${getElementCharacter(wuxing[bazi.hour.zhi])}。时柱代表晚年生活和后代情况，表明你晚年生活${getElderlyLife(bazi.hour)}，性格${getElderlyCharacter(bazi.hour)}。${bazi.hour.gan}${bazi.hour.zhi}组合显示你可能有${getElderlyFortune(bazi.hour)}，子女${getChildrenRelation(bazi.hour)}。建议你在年轻时就为晚年生活做好规划，注重家庭关系的维护，为晚年幸福打下基础。`;
            
            return {
                year: yearAnalysis,
                month: monthAnalysis,
                day: dayAnalysis,
                hour: hourAnalysis
            };
        }
        
        // 获取元素特性描述
        function getElementCharacter(element) {
            const characters = {
                '木': '正直、刚强、生长',
                '火': '热情、活力、光明',
                '土': '稳重、踏实、包容',
                '金': '果断、坚毅、正义',
                '水': '智慧、灵活、适应'
            };
            return characters[element] || '';
        }
        
        // 获取家庭背景描述
        function getFamilyBackground(yearColumn) {
            // 根据年柱的五行属性判断家庭背景
            const element = wuxing[yearColumn.gan];
            const backgrounds = {
                '木': '有一定文化底蕴',
                '火': '热情开朗',
                '土': '稳重踏实',
                '金': '有一定社会地位',
                '水': '聪明智慧'
            };
            return backgrounds[element] || '普通';
        }
        
        // 获取童年经历描述
        function getChildhoodExperience(yearColumn) {
            // 根据年柱的地支判断童年经历
            const zhi = yearColumn.zhi;
            const experiences = {
                '子': '受到良好的教育和家庭熏陶',
                '丑': '生活较为朴素，但家庭和睦',
                '寅': '活泼好动，充满好奇心',
                '卯': '温和有礼，受到长辈喜爱',
                '辰': '聪明好学，有较强的求知欲',
                '巳': '热情开朗，善于交际',
                '午': '精力充沛，有一定的领导才能',
                '未': '稳重踏实，做事认真',
                '申': '聪明机智，有较强的适应能力',
                '酉': '细心谨慎，做事有条理',
                '戌': '忠诚可靠，有较强的责任感',
                '亥': '聪明智慧，有较强的直觉'
            };
            return experiences[zhi] || '普通';
        }
        
        // 获取早期性格描述
        function getEarlyCharacter(yearColumn) {
            // 根据年柱的天干地支组合判断早期性格
            const gan = yearColumn.gan;
            const zhi = yearColumn.zhi;
            
            if (gan === '甲' || gan === '乙') {
                return '正直刚强，有主见';
            } else if (gan === '丙' || gan === '丁') {
                return '热情开朗，充满活力';
            } else if (gan === '戊' || gan === '己') {
                return '稳重踏实，有责任心';
            } else if (gan === '庚' || gan === '辛') {
                return '果断坚毅，有正义感';
            } else {
                return '聪明机智，适应力强';
            }
        }
        
        // 获取早期弱点描述
        function getEarlyWeakness(yearColumn) {
            // 根据年柱的天干地支组合判断早期弱点
            const gan = yearColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '有些固执，不易接受他人意见';
            } else if (gan === '丙' || gan === '丁') {
                return '有些急躁，缺乏耐心';
            } else if (gan === '戊' || gan === '己') {
                return '有些保守，缺乏创新精神';
            } else if (gan === '庚' || gan === '辛') {
                return '有些严厉，不够灵活';
            } else {
                return '情绪波动较大，不够稳定';
            }
        }
        
        // 获取父母性格描述
        function getParentCharacter(monthColumn) {
            // 根据月柱的天干地支组合判断父母性格
            const gan = monthColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '性格温和但做事认真';
            } else if (gan === '丙' || gan === '丁') {
                return '热情开朗但有些急躁';
            } else if (gan === '戊' || gan === '己') {
                return '稳重踏实但有些保守';
            } else if (gan === '庚' || gan === '辛') {
                return '果断坚毅但有些严厉';
            } else {
                return '聪明智慧但有些多变';
            }
        }
        
        // 获取父母教育描述
        function getParentEducation(monthColumn) {
            // 根据月柱的天干地支组合判断父母教育方式
            const gan = monthColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '较为宽松，注重培养独立性';
            } else if (gan === '丙' || gan === '丁') {
                return '较为热情，注重培养创造力';
            } else if (gan === '戊' || gan === '己') {
                return '较为严格，注重培养责任感';
            } else if (gan === '庚' || gan === '辛') {
                return '较为严厉，注重培养纪律性';
            } else {
                return '较为灵活，注重培养适应能力';
            }
        }
        
        // 获取少年性格描述
        function getYouthCharacter(monthColumn) {
            // 根据月柱的天干地支组合判断少年性格
            const gan = monthColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '性格较为内敛，学习能力强';
            } else if (gan === '丙' || gan === '丁') {
                return '性格较为活泼，创造力强';
            } else if (gan === '戊' || gan === '己') {
                return '性格较为稳重，做事认真';
            } else if (gan === '庚' || gan === '辛') {
                return '性格较为果断，有正义感';
            } else {
                return '性格较为灵活，适应能力强';
            }
        }
        
        // 获取少年弱点描述
        function getYouthWeakness(monthColumn) {
            // 根据月柱的天干地支组合判断少年弱点
            const gan = monthColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '有些缺乏自信，不够主动';
            } else if (gan === '丙' || gan === '丁') {
                return '有些好动，注意力不够集中';
            } else if (gan === '戊' || gan === '己') {
                return '有些保守，缺乏创新精神';
            } else if (gan === '庚' || gan === '辛') {
                return '有些固执，不够灵活';
            } else {
                return '有些多变，不够稳定';
            }
        }
        
        // 获取成年性格描述
        function getAdultCharacter(dayColumn) {
            // 根据日柱的天干地支组合判断成年性格
            const gan = dayColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '正直刚强，有主见';
            } else if (gan === '丙' || gan === '丁') {
                return '热情开朗，充满活力';
            } else if (gan === '戊' || gan === '己') {
                return '稳重踏实，有责任心';
            } else if (gan === '庚' || gan === '辛') {
                return '果断坚毅，有正义感';
            } else {
                return '聪明机智，适应力强';
            }
        }
        
        // 获取成年优势描述
        function getAdultStrength(dayColumn) {
            // 根据日柱的天干地支组合判断成年优势
            const gan = dayColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '较强的领导能力和创造力';
            } else if (gan === '丙' || gan === '丁') {
                return '较强的表达能力和感染力';
            } else if (gan === '戊' || gan === '己') {
                return '较强的执行力和责任感';
            } else if (gan === '庚' || gan === '辛') {
                return '较强的决断力和正义感';
            } else {
                return '较强的适应能力和洞察力';
            }
        }
        
        // 获取成年事业描述
        function getAdultCareer(dayColumn) {
            // 根据日柱的天干地支组合判断成年事业
            const gan = dayColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '事业有望取得较大发展，特别是在管理、创意方面';
            } else if (gan === '丙' || gan === '丁') {
                return '事业有望取得较大发展，特别是在表达、艺术方面';
            } else if (gan === '戊' || gan === '己') {
                return '事业有望取得较大发展，特别是在执行、管理方面';
            } else if (gan === '庚' || gan === '辛') {
                return '事业有望取得较大发展，特别是在决策、法律方面';
            } else {
                return '事业有望取得较大发展，特别是在分析、咨询方面';
            }
        }
        
        // 获取成年挑战描述
        function getAdultChallenge(dayColumn) {
            // 根据日柱的天干地支组合判断成年挑战
            const gan = dayColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '面临一些挑战和压力，需要保持开放的心态';
            } else if (gan === '丙' || gan === '丁') {
                return '面临一些挑战和压力，需要保持冷静的头脑';
            } else if (gan === '戊' || gan === '己') {
                return '面临一些挑战和压力，需要保持创新的精神';
            } else if (gan === '庚' || gan === '辛') {
                return '面临一些挑战和压力，需要保持灵活的态度';
            } else {
                return '面临一些挑战和压力，需要保持稳定的情绪';
            }
        }
        
        // 获取晚年生活描述
        function getElderlyLife(hourColumn) {
            // 根据时柱的天干地支组合判断晚年生活
            const gan = hourColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '较为充实，有较多的社交活动';
            } else if (gan === '丙' || gan === '丁') {
                return '较为活跃，有较多的兴趣爱好';
            } else if (gan === '戊' || gan === '己') {
                return '较为安稳，有较好的家庭环境';
            } else if (gan === '庚' || gan === '辛') {
                return '较为规律，有较好的生活习惯';
            } else {
                return '较为丰富，有较多的精神追求';
            }
        }
        
        // 获取晚年性格描述
        function getElderlyCharacter(hourColumn) {
            // 根据时柱的天干地支组合判断晚年性格
            const gan = hourColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '更加温和，有较强的包容心';
            } else if (gan === '丙' || gan === '丁') {
                return '更加开朗，有较强的乐观精神';
            } else if (gan === '戊' || gan === '己') {
                return '更加稳重，有较强的责任感';
            } else if (gan === '庚' || gan === '辛') {
                return '更加果断，有较强的决断力';
            } else {
                return '更加智慧，有较强的洞察力';
            }
        }
        
        // 获取晚年运势描述
        function getElderlyFortune(hourColumn) {
            // 根据时柱的天干地支组合判断晚年运势
            const gan = hourColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '较好的晚年运势，子女孝顺，家庭和睦';
            } else if (gan === '丙' || gan === '丁') {
                return '较好的晚年运势，生活充实，精神愉悦';
            } else if (gan === '戊' || gan === '己') {
                return '较好的晚年运势，生活安稳，身体健康';
            } else if (gan === '庚' || gan === '辛') {
                return '较好的晚年运势，生活规律，心态平和';
            } else {
                return '较好的晚年运势，生活丰富，精神充实';
            }
        }
        
        // 获取子女关系描述
        function getChildrenRelation(hourColumn) {
            // 根据时柱的天干地支组合判断子女关系
            const gan = hourColumn.gan;
            
            if (gan === '甲' || gan === '乙') {
                return '聪明有才华，与你关系融洽';
            } else if (gan === '丙' || gan === '丁') {
                return '活泼开朗，与你关系亲密';
            } else if (gan === '戊' || gan === '己') {
                return '稳重踏实，与你关系和谐';
            } else if (gan === '庚' || gan === '辛') {
                return '果断坚毅，与你关系尊重';
            } else {
                return '聪明机智，与你关系默契';
            }
        }
        
        // 生成大运分析
        function generateDayunAnalysis(bazi, year) {
            // 计算当前大运
            const currentYear = new Date().getFullYear();
            const currentDayun = dayunData.find(dayun => currentYear >= dayun.start && currentYear <= dayun.end) || dayunData[0];
            
            // 获取长生十二神阶段
            const changShengStage = getChangShengStage(bazi.day.gan, currentDayun.zhi);
            
            // 生成当前大运分析
            const currentDayunAnalysis = `你当前的大运为${currentDayun.name}（${currentDayun.start}-${currentDayun.end}年），${currentDayun.gan}土代表${getElementCharacter(wuxing[currentDayun.gan])}，${currentDayun.zhi}土代表${getElementCharacter(wuxing[currentDayun.zhi])}，处于${changShengStage}阶段。这十年是你${getDayunStage(currentDayun.start, year)}的关键期，${currentDayun.gan}土生金，对你的命局有${getDayunEffect(currentDayun.gan, bazi)}，有利于${getDayunBenefit(currentDayun.gan)}。但${currentDayun.zhi}土与你的日柱${bazi.day.gan}${bazi.day.zhi}${getDayunRelation(currentDayun.zhi, bazi.day.zhi)}，可能会${getDayunChallenge(currentDayun.zhi)}。建议你在这十年${getDayunAdvice(currentDayun.gan, currentDayun.zhi)}，为未来的发展打下基础。`;
            
            // 生成流年预测
            const liunianForecast = `${currentYear + 1}年${getLiunianGanZhi(currentYear + 1)}年，${getLiunianGan(currentYear + 1)}与你的日干${bazi.day.gan}${getLiunianRelation(getLiunianGan(currentYear + 1), bazi.day.gan)}，${getLiunianZhi(currentYear + 1)}与你的日支${bazi.day.zhi}${getLiunianRelation(getLiunianZhi(currentYear + 1), bazi.day.zhi)}，整体运势${getLiunianOverall(currentYear + 1, bazi)}。事业上${getLiunianCareer(currentYear + 1, bazi)}，财运${getLiunianFortune(currentYear + 1, bazi)}。但${getLiunianWarning(currentYear + 1, bazi)}。建议你${getLiunianAdvice(currentYear + 1, bazi)}，保持身心健康。`;
            
            return {
                current: currentDayunAnalysis,
                liunian: liunianForecast
            };
        }
        
        // 获取大运阶段描述
        function getDayunStage(startYear, birthYear) {
            const age = startYear - birthYear;
            if (age < 30) {
                return '事业起步';
            } else if (age < 40) {
                return '事业发展';
            } else if (age < 50) {
                return '事业成熟';
            } else {
                return '晚年生活';
            }
        }
        
        // 获取大运效果描述
        function getDayunEffect(gan, bazi) {
            const dayGan = bazi.day.gan;
            const dayGanWuxing = wuxing[dayGan];
            const ganWuxing = wuxing[gan];
            
            if (dayGanWuxing === '木' && ganWuxing === '土') {
                return '克制作用';
            } else if (dayGanWuxing === '火' && ganWuxing === '土') {
                return '生助作用';
            } else if (dayGanWuxing === '土' && ganWuxing === '土') {
                return '帮扶作用';
            } else if (dayGanWuxing === '金' && ganWuxing === '土') {
                return '生助作用';
            } else if (dayGanWuxing === '水' && ganWuxing === '土') {
                return '克制作用';
            } else {
                return '平衡作用';
            }
        }
        
        // 获取大运益处描述
        function getDayunBenefit(gan) {
            const ganWuxing = wuxing[gan];
            
            if (ganWuxing === '木') {
                return '创造力和表达能力的发展';
            } else if (ganWuxing === '火') {
                return '热情和活力的提升';
            } else if (ganWuxing === '土') {
                return '稳重和责任感的增强';
            } else if (ganWuxing === '金') {
                return '决断力和正义感的提升';
            } else {
                return '智慧和适应能力的增强';
            }
        }
        
        // 获取大运关系描述
        function getDayunRelation(zhi, dayZhi) {
            const zhiWuxing = wuxing[zhi];
            const dayZhiWuxing = wuxing[dayZhi];
            
            if (zhiWuxing === dayZhiWuxing) {
                return '相同';
            } else if (
                (zhiWuxing === '木' && dayZhiWuxing === '火') ||
                (zhiWuxing === '火' && dayZhiWuxing === '土') ||
                (zhiWuxing === '土' && dayZhiWuxing === '金') ||
                (zhiWuxing === '金' && dayZhiWuxing === '水') ||
                (zhiWuxing === '水' && dayZhiWuxing === '木')
            ) {
                return '相生';
            } else if (
                (zhiWuxing === '木' && dayZhiWuxing === '土') ||
                (zhiWuxing === '火' && dayZhiWuxing === '金') ||
                (zhiWuxing === '土' && dayZhiWuxing === '水') ||
                (zhiWuxing === '金' && dayZhiWuxing === '木') ||
                (zhiWuxing === '水' && dayZhiWuxing === '火')
            ) {
                return '相克';
            } else {
                return '平和';
            }
        }
        
        // 获取大运挑战描述
        function getDayunChallenge(zhi) {
            const zhiWuxing = wuxing[zhi];
            
            if (zhiWuxing === '木') {
                return '遇到一些挑战和阻力';
            } else if (zhiWuxing === '火') {
                return '遇到一些压力和挑战';
            } else if (zhiWuxing === '土') {
                return '遇到一些阻碍和困难';
            } else if (zhiWuxing === '金') {
                return '遇到一些冲突和矛盾';
            } else {
                return '遇到一些变化和波动';
            }
        }
        
        // 获取大运建议描述
        function getDayunAdvice(gan, zhi) {
            const ganWuxing = wuxing[gan];
            const zhiWuxing = wuxing[zhi];
            
            if (ganWuxing === '木' && zhiWuxing === '土') {
                return '保持稳健的作风，避免冒进';
            } else if (ganWuxing === '火' && zhiWuxing === '土') {
                return '保持热情，同时注重实际';
            } else if (ganWuxing === '土' && zhiWuxing === '土') {
                return '保持稳重，同时保持开放';
            } else if (ganWuxing === '金' && zhiWuxing === '土') {
                return '保持决断，同时注重灵活';
            } else {
                return '保持智慧，同时注重行动';
            }
        }
        
        // 获取流年干支
        function getLiunianGanZhi(year) {
            const offset = year - 1900 + 36;
            const ganIndex = offset % 10;
            const zhiIndex = offset % 12;
            return tianGan[ganIndex] + diZhi[zhiIndex];
        }
        
        // 获取流年天干
        function getLiunianGan(year) {
            const offset = year - 1900 + 36;
            const ganIndex = offset % 10;
            return tianGan[ganIndex];
        }
        
        // 获取流年地支
        function getLiunianZhi(year) {
            const offset = year - 1900 + 36;
            const zhiIndex = offset % 12;
            return diZhi[zhiIndex];
        }
        
        // 获取流年关系描述
        function getLiunianRelation(liunian, bazi) {
            const liunianWuxing = wuxing[liunian];
            const baziWuxing = wuxing[bazi];
            
            if (liunianWuxing === baziWuxing) {
                return '相同';
            } else if (
                (liunianWuxing === '木' && baziWuxing === '火') ||
                (liunianWuxing === '火' && baziWuxing === '土') ||
                (liunianWuxing === '土' && baziWuxing === '金') ||
                (liunianWuxing === '金' && baziWuxing === '水') ||
                (liunianWuxing === '水' && baziWuxing === '木')
            ) {
                return '相生';
            } else if (
                (liunianWuxing === '木' && baziWuxing === '土') ||
                (liunianWuxing === '火' && baziWuxing === '金') ||
                (liunianWuxing === '土' && baziWuxing === '水') ||
                (liunianWuxing === '金' && baziWuxing === '木') ||
                (liunianWuxing === '水' && baziWuxing === '火')
            ) {
                return '相克';
            } else {
                return '平和';
            }
        }
        
        // 获取流年总体运势描述
        function getLiunianOverall(year, bazi) {
            const liunianGan = getLiunianGan(year);
            const liunianZhi = getLiunianZhi(year);
            const dayGan = bazi.day.gan;
            const dayZhi = bazi.day.zhi;
            
            const ganRelation = getLiunianRelation(liunianGan, dayGan);
            const zhiRelation = getLiunianRelation(liunianZhi, dayZhi);
            
            if (ganRelation === '相生' && zhiRelation === '相生') {
                return '非常顺利';
            } else if (ganRelation === '相生' || zhiRelation === '相生') {
                return '较为顺利';
            } else if (ganRelation === '相克' && zhiRelation === '相克') {
                return '较为不顺';
            } else if (ganRelation === '相克' || zhiRelation === '相克') {
                return '有些不顺';
            } else {
                return '平稳';
            }
        }
        
        // 获取流年事业描述
        function getLiunianCareer(year, bazi) {
            const liunianGan = getLiunianGan(year);
            const liunianZhi = getLiunianZhi(year);
            const dayGan = bazi.day.gan;
            
            const ganRelation = getLiunianRelation(liunianGan, dayGan);
            
            if (ganRelation === '相生') {
                return '可能有新的机遇';
            } else if (ganRelation === '相克') {
                return '可能面临一些挑战';
            } else {
                return '可能保持稳定';
            }
        }
        
        // 获取流年财运描述
        function getLiunianFortune(year, bazi) {
            const liunianGan = getLiunianGan(year);
            const dayGan = bazi.day.gan;
            
            const ganRelation = getLiunianRelation(liunianGan, dayGan);
            
            if (ganRelation === '相生') {
                return '有所提升';
            } else if (ganRelation === '相克') {
                return '需要谨慎';
            } else {
                return '保持平稳';
            }
        }
        
        // 获取流年警告描述
        function getLiunianWarning(year, bazi) {
            const liunianZhi = getLiunianZhi(year);
            const dayZhi = bazi.day.zhi;
            
            const zhiRelation = getLiunianRelation(liunianZhi, dayZhi);
            
            if (zhiRelation === '相克') {
                const liunianZhiWuxing = wuxing[liunianZhi];
                if (liunianZhiWuxing === '火') {
                    return '需注意健康问题，特别是心脏和血液循环方面';
                } else if (liunianZhiWuxing === '水') {
                    return '需注意健康问题，特别是肾脏和泌尿系统方面';
                } else if (liunianZhiWuxing === '木') {
                    return '需注意健康问题，特别是肝胆和消化系统方面';
                } else if (liunianZhiWuxing === '金') {
                    return '需注意健康问题，特别是呼吸系统和骨骼方面';
                } else {
                    return '需注意健康问题，特别是脾胃和消化系统方面';
                }
            } else {
                return '整体运势较为平稳，无明显风险';
            }
        }
        
        // 获取流年建议描述
        function getLiunianAdvice(year, bazi) {
            const liunianGan = getLiunianGan(year);
            const liunianZhi = getLiunianZhi(year);
            const dayGan = bazi.day.gan;
            const dayZhi = bazi.day.zhi;
            
            const ganRelation = getLiunianRelation(liunianGan, dayGan);
            const zhiRelation = getLiunianRelation(liunianZhi, dayZhi);
            
            if (ganRelation === '相生' && zhiRelation === '相生') {
                return '抓住机遇，积极进取';
            } else if (ganRelation === '相生' || zhiRelation === '相生') {
                return '抓住机遇，谨慎行事';
            } else if (ganRelation === '相克' && zhiRelation === '相克') {
                return '保持谨慎，避免冒险';
            } else if (ganRelation === '相克' || zhiRelation === '相克') {
                return '保持谨慎，稳步前进';
            } else {
                return '保持平稳，按部就班';
            }
        }
        
        // 生成六亲分析
        function generateLiuqinAnalysis(bazi) {
            const dayGan = bazi.day.gan;
            
            // 父母运分析
            const parentsAnalysis = `你的年柱${bazi.year.gan}${bazi.year.zhi}，${bazi.year.gan}木为${shishen[dayGan][bazi.year.gan]}，${bazi.year.zhi}水为${shishen[dayGan][bazi.year.zhi]}，表明你与父母关系${getParentsRelation(bazi.year, dayGan)}，特别是与${getParentsFocus(bazi.year, dayGan)}关系亲密。父母可能对你的${getParentsSupport(bazi.year, dayGan)}投入较多，你也受益于父母的${getParentsBenefit(bazi.year, dayGan)}。建议你多关心父母的健康，特别是${getParentsHealthConcern(bazi.year, dayGan)}的健康。`;
            
            // 兄弟姐妹分析
            const siblingsAnalysis = `你的命局中${getSiblingsShishen(bazi, dayGan)}较多，表明你${getSiblingsStatus(bazi, dayGan)}，或者与朋友关系如同兄弟姐妹。${getSiblingsShishen(bazi, dayGan)}代表${getSiblingsMeaning(bazi, dayGan)}，你与兄弟姐妹之间可能${getSiblingsRelation(bazi, dayGan)}，但总体上是${getSiblingsOverall(bazi, dayGan)}。建议你在处理与兄弟姐妹的关系时，多些包容和理解，避免因小事而产生矛盾。`;
            
            // 婚姻感情分析
            const marriageAnalysis = `你的日柱${bazi.day.gan}${bazi.day.zhi}，${bazi.day.gan}火为日主，${bazi.day.zhi}木为${shishen[dayGan][bazi.day.zhi]}，表明你在感情方面${getMarriageCharacter(bazi.day)}，有${getMarriageStrength(bazi.day)}，但也可能${getMarriageWeakness(bazi.day)}。命局中${getMarriageShishen(bazi, dayGan)}都有，表明你在感情方面${getMarriageComplexity(bazi, dayGan)}，既有${getMarriageStable(bazi, dayGan)}，也可能有${getMarriageOpportunity(bazi, dayGan)}。建议你在感情中${getMarriageAdvice(bazi, dayGan)}，避免因冲动而做出决定，同时多与伴侣沟通，增进理解。`;
            
            // 子女运分析
            const childrenAnalysis = `你的时柱${bazi.hour.gan}${bazi.hour.zhi}，${bazi.hour.gan}火为${shishen[dayGan][bazi.hour.gan]}，${bazi.hour.zhi}木为${shishen[dayGan][bazi.hour.zhi]}，表明你与子女关系${getChildrenRelation(bazi.hour)}，子女可能${getChildrenCharacter(bazi.hour)}。${shishen[dayGan][bazi.hour.gan]}代表${getChildrenGender(bazi.hour.gan, dayGan)}，${shishen[dayGan][bazi.hour.zhi]}代表${getChildrenGender(bazi.hour.zhi, dayGan)}，表明你${getChildrenStatus(bazi.hour)}，且子女在${getChildrenTalent(bazi.hour)}方面有一定天赋。建议你在子女教育方面多给予支持和鼓励，同时注意培养他们的${getChildrenCultivation(bazi.hour)}，为他们的未来发展打下良好基础。`;
            
            return {
                parents: parentsAnalysis,
                siblings: siblingsAnalysis,
                marriage: marriageAnalysis,
                children: childrenAnalysis
            };
        }
        
        // 获取父母关系描述
        function getParentsRelation(yearColumn, dayGan) {
            const yearGanShishen = shishen[dayGan][yearColumn.gan];
            const yearZhiShishen = shishen[dayGan][yearColumn.zhi];
            
            if (yearGanShishen === '正印' || yearZhiShishen === '正印') {
                return '较为融洽';
            } else if (yearGanShishen === '偏印' || yearZhiShishen === '偏印') {
                return '有些复杂';
            } else {
                return '一般';
            }
        }
        
        // 获取父母关注点描述
        function getParentsFocus(yearColumn, dayGan) {
            const yearGanShishen = shishen[dayGan][yearColumn.gan];
            const yearZhiShishen = shishen[dayGan][yearColumn.zhi];
            
            if (yearGanShishen === '正印' || yearZhiShishen === '正印') {
                return '母亲';
            } else if (yearGanShishen === '偏印' || yearZhiShishen === '偏印') {
                return '庶母或特殊长辈';
            } else {
                return '父母双方';
            }
        }
        
        // 获取父母支持描述
        function getParentsSupport(yearColumn, dayGan) {
            const yearGanWuxing = wuxing[yearColumn.gan];
            
            if (yearGanWuxing === '木') {
                return '教育和成长';
            } else if (yearGanWuxing === '火') {
                return '情感和关怀';
            } else if (yearGanWuxing === '土') {
                return '物质和稳定';
            } else if (yearGanWuxing === '金') {
                return '纪律和规范';
            } else {
                return '智慧和指导';
            }
        }
        
        // 获取父母益处描述
        function getParentsBenefit(yearColumn, dayGan) {
            const yearGanWuxing = wuxing[yearColumn.gan];
            
            if (yearGanWuxing === '木') {
                return '指导和支持';
            } else if (yearGanWuxing === '火') {
                return '温暖和鼓励';
            } else if (yearGanWuxing === '土') {
                return '稳定和保障';
            } else if (yearGanWuxing === '金') {
                return '规范和引导';
            } else {
                return '智慧和启发';
            }
        }
        
        // 获取父母健康关注描述
        function getParentsHealthConcern(yearColumn, dayGan) {
            const yearGanWuxing = wuxing[yearColumn.gan];
            const yearZhiWuxing = wuxing[yearColumn.zhi];
            
            if (yearGanWuxing === '木' || yearZhiWuxing === '木') {
                return '肝胆和消化系统';
            } else if (yearGanWuxing === '火' || yearZhiWuxing === '火') {
                return '心脏和血液循环';
            } else if (yearGanWuxing === '土' || yearZhiWuxing === '土') {
                return '脾胃和消化系统';
            } else if (yearGanWuxing === '金' || yearZhiWuxing === '金') {
                return '呼吸系统和骨骼';
            } else {
                return '肾脏和泌尿系统';
            }
        }
        
        // 获取兄弟姐妹十神描述
        function getSiblingsShishen(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '比肩' || ganShishen === '劫财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '比肩' || zhiShishen === '劫财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            const mainShishen = Object.keys(shishenCount).filter(key => shishenCount[key] > 0);
            return mainShishen.join('、');
        }
        
        // 获取兄弟姐妹状态描述
        function getSiblingsStatus(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '比肩' || ganShishen === '劫财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '比肩' || zhiShishen === '劫财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            const totalCount = Object.values(shishenCount).reduce((sum, count) => sum + count, 0);
            
            if (totalCount >= 3) {
                return '可能有多个兄弟姐妹，或者与朋友关系如同兄弟姐妹';
            } else if (totalCount >= 1) {
                return '可能有兄弟姐妹，或者与朋友关系如同兄弟姐妹';
            } else {
                return '可能独生，或者与朋友关系一般';
            }
        }
        
        // 获取兄弟姐妹含义描述
        function getSiblingsMeaning(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '比肩' || ganShishen === '劫财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '比肩' || zhiShishen === '劫财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            const meanings = [];
            if (shishenCount['比肩'] > 0) {
                meanings.push('同性兄弟姐妹或朋友');
            }
            if (shishenCount['劫财'] > 0) {
                meanings.push('异性兄弟姐妹或朋友');
            }
            
            return meanings.join('、');
        }
        
        // 获取兄弟姐妹关系描述
        function getSiblingsRelation(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '比肩' || ganShishen === '劫财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '比肩' || zhiShishen === '劫财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            if (shishenCount['比肩'] > shishenCount['劫财']) {
                return '存在一定的竞争关系';
            } else if (shishenCount['劫财'] > shishenCount['比肩']) {
                return '存在一定的互补关系';
            } else {
                return '关系较为平衡';
            }
        }
        
        // 获取兄弟姐妹总体描述
        function getSiblingsOverall(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '比肩' || ganShishen === '劫财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '比肩' || zhiShishen === '劫财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            const totalCount = Object.values(shishenCount).reduce((sum, count) => sum + count, 0);
            
            if (totalCount >= 3) {
                return '互相支持，但也可能存在竞争';
            } else if (totalCount >= 1) {
                return '互相支持，关系较好';
            } else {
                return '关系一般，互动较少';
            }
        }
        
        // 获取婚姻性格描述
        function getMarriageCharacter(dayColumn) {
            const dayGanWuxing = wuxing[dayColumn.gan];
            
            if (dayGanWuxing === '木') {
                return '较为正直，有主见';
            } else if (dayGanWuxing === '火') {
                return '较为热情，有活力';
            } else if (dayGanWuxing === '土') {
                return '较为稳重，有责任心';
            } else if (dayGanWuxing === '金') {
                return '较为果断，有正义感';
            } else {
                return '较为灵活，有智慧';
            }
        }
        
        // 获取婚姻优势描述
        function getMarriageStrength(dayColumn) {
            const dayGanWuxing = wuxing[dayColumn.gan];
            
            if (dayGanWuxing === '木') {
                return '创造力和表达能力';
            } else if (dayGanWuxing === '火') {
                return '热情和感染力';
            } else if (dayGanWuxing === '土') {
                return '稳重和责任感';
            } else if (dayGanWuxing === '金') {
                return '决断力和正义感';
            } else {
                return '智慧和适应能力';
            }
        }
        
        // 获取婚姻弱点描述
        function getMarriageWeakness(dayColumn) {
            const dayGanWuxing = wuxing[dayColumn.gan];
            
            if (dayGanWuxing === '木') {
                return '有些理想化';
            } else if (dayGanWuxing === '火') {
                return '有些急躁';
            } else if (dayGanWuxing === '土') {
                return '有些保守';
            } else if (dayGanWuxing === '金') {
                return '有些严厉';
            } else {
                return '有些多变';
            }
        }
        
        // 获取婚姻十神描述
        function getMarriageShishen(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '正财' || ganShishen === '偏财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '正财' || zhiShishen === '偏财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            const mainShishen = Object.keys(shishenCount).filter(key => shishenCount[key] > 0);
            return mainShishen.join('、');
        }
        
        // 获取婚姻复杂性描述
        function getMarriageComplexity(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '正财' || ganShishen === '偏财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '正财' || zhiShishen === '偏财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            if (shishenCount['正财'] > 0 && shishenCount['偏财'] > 0) {
                return '有一定的复杂性';
            } else if (shishenCount['偏财'] > 0) {
                return '可能有些复杂';
            } else {
                return '相对简单';
            }
        }
        
        // 获取婚姻稳定描述
        function getMarriageStable(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '正财' || ganShishen === '偏财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '正财' || zhiShishen === '偏财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            if (shishenCount['正财'] > 0) {
                return '稳定的感情关系';
            } else {
                return '一定的感情基础';
            }
        }
        
        // 获取婚姻机会描述
        function getMarriageOpportunity(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '正财' || ganShishen === '偏财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '正财' || zhiShishen === '偏财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            if (shishenCount['偏财'] > 0) {
                return '一些外遇的机会';
            } else {
                return '较少的外遇机会';
            }
        }
        
        // 获取婚姻建议描述
        function getMarriageAdvice(bazi, dayGan) {
            const shishenCount = {};
            Object.values(bazi).forEach(column => {
                const ganShishen = shishen[dayGan][column.gan];
                const zhiShishen = shishen[dayGan][column.zhi];
                
                if (ganShishen === '正财' || ganShishen === '偏财') {
                    shishenCount[ganShishen] = (shishenCount[ganShishen] || 0) + 1;
                }
                
                if (zhiShishen === '正财' || zhiShishen === '偏财') {
                    shishenCount[zhiShishen] = (shishenCount[zhiShishen] || 0) + 1;
                }
            });
            
            if (shishenCount['偏财'] > shishenCount['正财']) {
                return '保持真诚和专一，避免因冲动而做出决定';
            } else {
                return '保持真诚和专一，多与伴侣沟通';
            }
        }
        
        // 获取子女性别描述
        function getChildrenGender(gan, dayGan) {
            const shishenName = shishen[dayGan][gan];
            
            if (shishenName === '食神') {
                return '女儿';
            } else if (shishenName === '伤官') {
                return '儿子';
            } else {
                return '子女';
            }
        }
        
        // 获取子女状态描述
        function getChildrenStatus(hourColumn) {
            const hourGanWuxing = wuxing[hourColumn.gan];
            
            if (hourGanWuxing === '木') {
                return '可能有子女，且子女聪明有才华';
            } else if (hourGanWuxing === '火') {
                return '可能有子女，且子女热情活泼';
            } else if (hourGanWuxing === '土') {
                return '可能有子女，且子女稳重踏实';
            } else if (hourGanWuxing === '金') {
                return '可能有子女，且子女果断坚毅';
            } else {
                return '可能有子女，且子女聪明机智';
            }
        }
        
        // 获取子女性格描述
        function getChildrenCharacter(hourColumn) {
            const hourGanWuxing = wuxing[hourColumn.gan];
            
            if (hourGanWuxing === '木') {
                return '聪明有才华';
            } else if (hourGanWuxing === '火') {
                return '热情活泼';
            } else if (hourGanWuxing === '土') {
                return '稳重踏实';
            } else if (hourGanWuxing === '金') {
                return '果断坚毅';
            } else {
                return '聪明机智';
            }
        }
        
        // 获取子女天赋描述
        function getChildrenTalent(hourColumn) {
            const hourGanWuxing = wuxing[hourColumn.gan];
            
            if (hourGanWuxing === '木') {
                return '艺术、创造';
            } else if (hourGanWuxing === '火') {
                return '表达、表演';
            } else if (hourGanWuxing === '土') {
                return '管理、组织';
            } else if (hourGanWuxing === '金') {
                return '决策、分析';
            } else {
                return '智慧、学习';
            }
        }
        
        // 获取子女培养描述
        function getChildrenCultivation(hourColumn) {
            const hourGanWuxing = wuxing[hourColumn.gan];
            
            if (hourGanWuxing === '木') {
                return '责任感和独立性';
            } else if (hourGanWuxing === '火') {
                return '耐心和专注力';
            } else if (hourGanWuxing === '土') {
                return '创新精神和灵活性';
            } else if (hourGanWuxing === '金') {
                return '包容心和沟通能力';
            } else {
                return '稳定性和执行力';
            }
        }
        
        // 计算用神忌神
        function calculateYongShenJiShen(bazi, wuxingDistribution, wuxingStrength) {
            // 获取日主（日干）
            const riZhu = bazi.day.gan;
            const riZhuWuxing = wuxing[riZhu];
            
            // 初始化用神和忌神
            let yongShen = [];
            let jiShen = [];
            
            // 根据日主强弱判断用神忌神
            // 首先判断日主的旺衰状态
            const riZhuStrength = wuxingStrength[riZhuWuxing];
            
            // 如果日主偏旺，则需要克制日主的五行为用神，生助日主的五行为忌神
            // 如果日主偏弱，则需要生助日主的五行为用神，克制日主的五行为忌神
            if (riZhuStrength === '偏旺') {
                // 日主偏旺，需要克制
                if (riZhuWuxing === '木') {
                    yongShen = ['金', '土'];  // 金克木，土耗木
                    jiShen = ['水', '木'];    // 水生木，木帮木
                } else if (riZhuWuxing === '火') {
                    yongShen = ['水', '金'];  // 水克火，金耗火
                    jiShen = ['木', '火'];    // 木生火，火帮火
                } else if (riZhuWuxing === '土') {
                    yongShen = ['木', '水'];  // 木克土，水耗土
                    jiShen = ['火', '土'];    // 火生土，土帮土
                } else if (riZhuWuxing === '金') {
                    yongShen = ['火', '木'];  // 火克金，木耗金
                    jiShen = ['土', '金'];    // 土生金，金帮金
                } else if (riZhuWuxing === '水') {
                    yongShen = ['土', '火'];  // 土克水，火耗水
                    jiShen = ['金', '水'];    // 金生水，水帮水
                }
            } else if (riZhuStrength === '偏弱') {
                // 日主偏弱，需要生助
                if (riZhuWuxing === '木') {
                    yongShen = ['水', '木'];  // 水生木，木帮木
                    jiShen = ['金', '土'];    // 金克木，土耗木
                } else if (riZhuWuxing === '火') {
                    yongShen = ['木', '火'];  // 木生火，火帮火
                    jiShen = ['水', '金'];    // 水克火，金耗火
                } else if (riZhuWuxing === '土') {
                    yongShen = ['火', '土'];  // 火生土，土帮土
                    jiShen = ['木', '水'];    // 木克土，水耗土
                } else if (riZhuWuxing === '金') {
                    yongShen = ['土', '金'];  // 土生金，金帮金
                    jiShen = ['火', '木'];    // 火克金，木耗金
                } else if (riZhuWuxing === '水') {
                    yongShen = ['金', '水'];  // 金生水，水帮水
                    jiShen = ['土', '火'];    // 土克水，火耗水
                }
            } else {
                // 日主平衡，根据具体分布判断
                // 查看哪种五行数量最多，作为可能的忌神
                let maxElement = '';
                let maxCount = 0;
                Object.keys(wuxingDistribution).forEach(element => {
                    if (wuxingDistribution[element] > maxCount) {
                        maxCount = wuxingDistribution[element];
                        maxElement = element;
                    }
                });
                
                // 查看哪种五行数量最少，作为可能的用神
                let minElement = '';
                let minCount = 10;
                Object.keys(wuxingDistribution).forEach(element => {
                    if (wuxingDistribution[element] < minCount) {
                        minCount = wuxingDistribution[element];
                        minElement = element;
                    }
                });
                
                // 设置用神和忌神
                yongShen = [minElement];
                jiShen = [maxElement];
            }
            
            return {
                yongShen: yongShen,
                jiShen: jiShen
            };
        }
        
        // 生成用神忌神分析文本
        function generateYongShenAnalysis(bazi, yongShenJiShen) {
            const riZhu = bazi.day.gan;
            const riZhuWuxing = wuxing[riZhu];
            
            let analysis = `你的日主为${riZhu}(${riZhuWuxing})，`;
            
            if (yongShenJiShen.yongShen.length > 0) {
                analysis += `用神为${yongShenJiShen.yongShen.join('、')}，`;
            }
            
            if (yongShenJiShen.jiShen.length > 0) {
                analysis += `忌神为${yongShenJiShen.jiShen.join('、')}。`;
            }
            
            analysis += "用神是你命局中对你有利的五行，宜多接触相关事物；忌神是你命局中对你不利的五行，宜少接触或通过用神来化解。";
            
            return analysis;
        }
        
        // 生成命理组合分析
        function generateMingliCombinationAnalysis(bazi) {
            // 统计五行分布
            const distribution = calculateWuxingDistribution(bazi);
            
            // 判断主要五行
            const mainElements = [];
            const weakElements = [];
            
            Object.keys(distribution).forEach(element => {
                if (distribution[element] >= 2) {
                    mainElements.push(element);
                } else if (distribution[element] === 0) {
                    weakElements.push(element);
                }
            });
            
            // 生成分析文本
            let analysisText = '你的命局中';
            
            if (mainElements.length > 0) {
                analysisText += mainElements.join('、') + '较旺';
            }
            
            if (weakElements.length > 0) {
                if (mainElements.length > 0) {
                    analysisText += '，';
                }
                analysisText += weakElements.join('、') + '较弱';
            }
            
            // 添加命理组合描述
            if (mainElements.includes('木') && mainElements.includes('火')) {
                analysisText += '，形成了一种"木火通明"的组合。这种组合的人通常聪明有才华，有较强的创造力和领导能力，但也可能有些急躁和冲动。';
            } else if (mainElements.includes('金') && mainElements.includes('水')) {
                analysisText += '，形成了一种"金水相生"的组合。这种组合的人通常聪明机智，有较强的适应能力和洞察力，但也可能有些多变和不够稳定。';
            } else if (mainElements.includes('土') && mainElements.includes('金')) {
                analysisText += '，形成了一种"土金相生"的组合。这种组合的人通常稳重踏实，有较强的执行力和责任感，但也可能有些保守和缺乏创新。';
            } else if (mainElements.includes('水') && mainElements.includes('木')) {
                analysisText += '，形成了一种"水木相生"的组合。这种组合的人通常聪明有才华，有较强的学习能力和创造力，但也可能有些理想化和不够实际。';
            } else if (mainElements.includes('火') && mainElements.includes('土')) {
                analysisText += '，形成了一种"火土相生"的组合。这种组合的人通常热情有活力，有较强的表达能力和感染力，但也可能有些急躁和缺乏耐心。';
            } else {
                analysisText += '，五行分布较为均衡。这种组合的人通常性格较为平衡，有较强的适应能力，但也可能缺乏突出的特点和优势。';
            }
            
            // 添加适合职业描述
            analysisText += '木火通明的人适合从事与创意、教育、艺术等相关的工作，在这些领域有较大的发展潜力。';
            
            // 添加注意事项
            analysisText += '但需要注意的是，木火过旺可能会消耗金水，导致健康和财务方面的问题。建议你在发挥自己优势的同时，注意平衡五行，特别是增强金水元素，以保持身心的健康和平衡。';
            
            return analysisText;
        }
        
        // 生成风水布局建议（根据用神忌神优化）
        function generateFengshuiAdvice(yongShenJiShen) {
            const yongShen = yongShenJiShen.yongShen;
            const jiShen = yongShenJiShen.jiShen;
            
            // 定义五行对应的方向和颜色
            const elementDirections = {
                '木': { directions: ['东', '东南'], colors: ['绿色'] },
                '火': { directions: ['南'], colors: ['红色', '紫色'] },
                '土': { directions: ['中', '西南', '东北'], colors: ['黄色', '棕色'] },
                '金': { directions: ['西', '西北'], colors: ['白色', '金色'] },
                '水': { directions: ['北'], colors: ['黑色', '蓝色'] }
            };
            
            // 定义五行对应的物品
            const elementItems = {
                '木': ['绿色植物', '木质家具'],
                '火': ['红色装饰品', '照明设备'],
                '土': ['陶瓷制品', '石材装饰'],
                '金': ['金属饰品', '白色物品'],
                '水': ['鱼缸', '水景装饰']
            };
            
            // 生成建议文本
            let adviceText = '<ul class="jiehua-list">';
            
            // 用神建议
            if (yongShen.length > 0) {
                adviceText += '<li><strong>增强用神元素：</strong>';
                yongShen.forEach(element => {
                    if (elementDirections[element]) {
                        adviceText += `在${elementDirections[element].directions.join('、')}方向布置${element}元素，使用${elementDirections[element].colors.join('、')}颜色的装饰；`;
                        adviceText += `可摆放${elementItems[element].join('、')}等物品；`;
                    }
                });
                adviceText += '</li>';
            }
            
            // 忌神建议
            if (jiShen.length > 0) {
                adviceText += '<li><strong>避免或化解忌神元素：</strong>';
                jiShen.forEach(element => {
                    if (elementDirections[element]) {
                        adviceText += `避免在${elementDirections[element].directions.join('、')}方向布置${element}元素，减少使用${elementDirections[element].colors.join('、')}颜色的装饰；`;
                        adviceText += `减少${elementItems[element].join('、')}等物品的使用；`;
                    }
                });
                adviceText += '</li>';
            }
            
            // 特殊建议
            adviceText += '<li><strong>整体平衡建议：</strong>保持居住和工作环境的整洁有序，定期清理杂物；根据用神五行选择合适的装饰品和家具；在办公桌或床头放置有助于增强用神的小物件。</li>';
            
            adviceText += '</ul>';
            
            return adviceText;
        }
        
        // 出生日期选择事件（实时转换农历日期）
        document.getElementById('birthdate').addEventListener('change', function() {
            const birthdate = this.value;
            if (birthdate) {
                const dateObj = new Date(birthdate);
                // 检查是否已经选择了时辰
                const hourSelect = document.getElementById('hour');
                if (hourSelect && hourSelect.value !== '') {
                    // 如果已选择时辰，则显示包含时辰的农历日期
                    const hourIndex = parseInt(hourSelect.value);
                    // 根据用户选择的时辰索引计算具体的小时数
                    let hour, minute;
                    switch(hourIndex) {
                        case 0: // 子时
                            hour = 23; // 取子时中间时刻
                            minute = 0;
                            break;
                        case 1: // 丑时
                            hour = 2;
                            minute = 0;
                            break;
                        case 2: // 寅时
                            hour = 4;
                            minute = 0;
                            break;
                        case 3: // 卯时
                            hour = 6;
                            minute = 0;
                            break;
                        case 4: // 辰时
                            hour = 8;
                            minute = 0;
                            break;
                        case 5: // 巳时
                            hour = 10;
                            minute = 0;
                            break;
                        case 6: // 午时
                            hour = 12;
                            minute = 0;
                            break;
                        case 7: // 未时
                            hour = 14;
                            minute = 0;
                            break;
                        case 8: // 申时
                            hour = 16;
                            minute = 0;
                            break;
                        case 9: // 酉时
                            hour = 18;
                            minute = 0;
                            break;
                        case 10: // 戌时
                            hour = 20;
                            minute = 0;
                            break;
                        case 11: // 亥时
                            hour = 22;
                            minute = 0;
                            break;
                        default:
                            hour = 12;
                            minute = 0;
                    }
                    
                    // 设置具体的出生时间
                    dateObj.setHours(hour, minute, 0, 0);
                    const lunarDate = Lunar.fromDate(dateObj);
                    const lunarDateString = `${lunarDate.getYearInChinese()}年 ${lunarDate.getMonthInChinese()}月 ${lunarDate.getDayInChinese()}日 ${lunarDate.getTimeZhi()}时 (${lunarDate.getYearGanExact()}${lunarDate.getYearZhiExact()}年 ${lunarDate.getMonthGanExact()}${lunarDate.getMonthZhiExact()}月 ${lunarDate.getDayGanExact()}${lunarDate.getDayZhiExact()}日 ${lunarDate.getTimeGan()}${lunarDate.getTimeZhi()}时)`;
                    document.getElementById('lunar-date-text').textContent = lunarDateString;
                } else {
                    // 如果未选择时辰，则只显示年月日
                    const lunarDate = Lunar.fromDate(dateObj);
                    const lunarDateString = `${lunarDate.getYearInChinese()}年 ${lunarDate.getMonthInChinese()}月 ${lunarDate.getDayInChinese()}日`;
                    document.getElementById('lunar-date-text').textContent = lunarDateString;
                }
                document.getElementById('lunar-date-display').style.display = 'block';
            } else {
                document.getElementById('lunar-date-display').style.display = 'none';
            }
        });
        
        // 时辰选择事件（更新农历日期显示）
        document.getElementById('hour').addEventListener('change', function() {
            // 触发出生日期的change事件以更新农历日期显示
            const birthdateInput = document.getElementById('birthdate');
            if (birthdateInput.value) {
                // 手动触发change事件
                birthdateInput.dispatchEvent(new Event('change'));
            }
        });
        
        // 表单提交事件
        document.getElementById('bazi-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 显示加载动画
            document.getElementById('loader').style.display = 'block';
            
            // 获取表单数据
            const birthdate = document.getElementById('birthdate').value;
            const dateObj = new Date(birthdate);
            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1; // 月份从0开始，需要加1
            const day = dateObj.getDate();
            const hourIndex = parseInt(document.getElementById('hour').value);
            const gender = document.getElementById('gender').value;
            
            // 根据用户选择的时辰索引计算具体的小时数
            // 时辰对应关系：0-子时(23:00-01:00), 1-丑时(01:00-03:00), ..., 11-亥时(21:00-23:00)
            let hour, minute;
            switch(hourIndex) {
                case 0: // 子时
                    hour = 23; // 取子时中间时刻
                    minute = 0;
                    break;
                case 1: // 丑时
                    hour = 2;
                    minute = 0;
                    break;
                case 2: // 寅时
                    hour = 4;
                    minute = 0;
                    break;
                case 3: // 卯时
                    hour = 6;
                    minute = 0;
                    break;
                case 4: // 辰时
                    hour = 8;
                    minute = 0;
                    break;
                case 5: // 巳时
                    hour = 10;
                    minute = 0;
                    break;
                case 6: // 午时
                    hour = 12;
                    minute = 0;
                    break;
                case 7: // 未时
                    hour = 14;
                    minute = 0;
                    break;
                case 8: // 申时
                    hour = 16;
                    minute = 0;
                    break;
                case 9: // 酉时
                    hour = 18;
                    minute = 0;
                    break;
                case 10: // 戌时
                    hour = 20;
                    minute = 0;
                    break;
                case 11: // 亥时
                    hour = 22;
                    minute = 0;
                    break;
                default:
                    hour = 12;
                    minute = 0;
            }
            
            // 设置具体的出生时间
            dateObj.setHours(hour, minute, 0, 0);
            
            // 使用农历库进行转换和计算
            // 注意：这里我们使用完整的日期时间来创建农历对象，以确保时辰计算准确
            const lunarDate = Lunar.fromDate(dateObj);
            
            // 显示转换后的农历日期
            const lunarDateString = `${lunarDate.getYearInChinese()}年 ${lunarDate.getMonthInChinese()}月 ${lunarDate.getDayInChinese()}日 ${lunarDate.getTimeZhi()}时 (${lunarDate.getYearGanExact()}${lunarDate.getYearZhiExact()}年 ${lunarDate.getMonthGanExact()}${lunarDate.getMonthZhiExact()}月 ${lunarDate.getDayGanExact()}${lunarDate.getDayZhiExact()}日 ${lunarDate.getTimeGan()}${lunarDate.getTimeZhi()}时)`;
            document.getElementById('lunar-date-text').textContent = lunarDateString;
            document.getElementById('lunar-date-display').style.display = 'block';
            
            // 模拟计算延迟
            setTimeout(() => {
                // 计算八字（使用农历库提供的准确算法）
                // 年柱使用立春交接时刻为准的精确干支
                const yearColumn = {
                    gan: lunarDate.getYearGanExact(),
                    zhi: lunarDate.getYearZhiExact()
                };
                // 月柱使用节气交接时刻为准的精确干支
                const monthColumn = {
                    gan: lunarDate.getMonthGanExact(),
                    zhi: lunarDate.getMonthZhiExact()
                };
                // 日柱使用精确的干支计算
                const dayColumn = {
                    gan: lunarDate.getDayGanExact(),
                    zhi: lunarDate.getDayZhiExact()
                };
                // 时柱使用精确的干支计算
                const hourColumn = {
                    gan: lunarDate.getTimeGan(),
                    zhi: lunarDate.getTimeZhi()
                };
            
            const bazi = {
                year: yearColumn,
                month: monthColumn,
                day: dayColumn,
                hour: hourColumn
            };
                
                // 更新八字显示
                document.getElementById('year-gan').textContent = bazi.year.gan;
                document.getElementById('year-zhi').textContent = bazi.year.zhi;
                document.getElementById('month-gan').textContent = bazi.month.gan;
                document.getElementById('month-zhi').textContent = bazi.month.zhi;
                document.getElementById('day-gan').textContent = bazi.day.gan;
                document.getElementById('day-zhi').textContent = bazi.day.zhi;
                document.getElementById('hour-gan').textContent = bazi.hour.gan;
                document.getElementById('hour-zhi').textContent = bazi.hour.zhi;
                
                // 计算五行分布
                const wuxingDistribution = calculateWuxingDistribution(bazi);
                
                // 更新五行显示
                document.getElementById('mu-value').textContent = wuxingDistribution['木'];
                document.getElementById('huo-value').textContent = wuxingDistribution['火'];
                document.getElementById('tu-value').textContent = wuxingDistribution['土'];
                document.getElementById('jin-value').textContent = wuxingDistribution['金'];
                document.getElementById('shui-value').textContent = wuxingDistribution['水'];
                
                // 判断五行旺衰
                const wuxingStrength = judgeWuxingStrength(wuxingDistribution);
                
                // 更新五行旺衰显示
                document.getElementById('mu-desc').textContent = wuxingStrength['木'];
                document.getElementById('huo-desc').textContent = wuxingStrength['火'];
                document.getElementById('tu-desc').textContent = wuxingStrength['土'];
                document.getElementById('jin-desc').textContent = wuxingStrength['金'];
                document.getElementById('shui-desc').textContent = wuxingStrength['水'];
                
                // 生成五行分析文本
                const wuxingAnalysisText = generateWuxingAnalysisText(wuxingDistribution, wuxingStrength);
                document.getElementById('wuxing-analysis-text').textContent = wuxingAnalysisText;
                
                // 生成十神表格
                generateShishenTable(bazi);
                
                // 生成十神综合分析
                const shishenComprehensive = generateShishenComprehensiveAnalysis(bazi);
                document.getElementById('shishen-comprehensive').textContent = shishenComprehensive;
                
                // 生成四柱分析
                const sizhuAnalysis = generateSizhuAnalysis(bazi);
                document.getElementById('year-column-analysis').textContent = sizhuAnalysis.year;
                document.getElementById('month-column-analysis').textContent = sizhuAnalysis.month;
                document.getElementById('day-column-analysis').textContent = sizhuAnalysis.day;
                document.getElementById('hour-column-analysis').textContent = sizhuAnalysis.hour;
                
                // 生成大运分析
                const dayunAnalysis = generateDayunAnalysis(bazi, year);
                document.getElementById('current-dayun').textContent = dayunAnalysis.current;
                document.getElementById('liunian-forecast').textContent = dayunAnalysis.liunian;
                
                // 生成六亲分析
                const liuqinAnalysis = generateLiuqinAnalysis(bazi);
                document.querySelector('.liuqin-item:nth-child(1) p').textContent = liuqinAnalysis.parents;
                document.querySelector('.liuqin-item:nth-child(2) p').textContent = liuqinAnalysis.siblings;
                document.querySelector('.liuqin-item:nth-child(3) p').textContent = liuqinAnalysis.marriage;
                document.querySelector('.liuqin-item:nth-child(4) p').textContent = liuqinAnalysis.children;
                
                // 计算用神忌神
                const yongShenJiShen = calculateYongShenJiShen(bazi, wuxingDistribution, wuxingStrength);
                
                // 生成用神忌神分析文本
                const yongShenAnalysis = generateYongShenAnalysis(bazi, yongShenJiShen);
                document.getElementById('yongshen-analysis').textContent = yongShenAnalysis;
                
                // 生成命理组合分析
                const mingliCombination = generateMingliCombinationAnalysis(bazi);
                document.getElementById('mingli-combination').textContent = mingliCombination;
                
                // 生成风水布局建议（根据用神忌神优化）
                const fengshuiAdvice = generateFengshuiAdvice(yongShenJiShen);
                document.getElementById('fengshui-advice').innerHTML = fengshuiAdvice;
                
                // 隐藏加载动画，显示结果
                document.getElementById('loader').style.display = 'none';
                document.getElementById('bazi-result').style.display = 'block';
                
                // 滚动到结果区域
                document.getElementById('bazi-result').scrollIntoView({ behavior: 'smooth' });
            }, 1500);
        });
        
        // 选项卡切换
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // 移除所有选项卡的active类
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // 添加当前选项卡的active类
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // 保存报告按钮
        document.getElementById('save-report').addEventListener('click', function() {
            // 创建一个临时链接来下载报告
            const reportContent = document.getElementById('bazi-result').innerHTML;
            const blob = new Blob([reportContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '专业八字命理分析报告.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
        
        // 分享报告按钮
        document.getElementById('share-report').addEventListener('click', function() {
            if (navigator.share) {
                navigator.share({
                    title: '我的专业八字命理分析报告',
                    text: '我刚刚生成了一份专业的八字命理分析报告，一起来看看吧！',
                    url: window.location.href
                });
            } else {
                // 如果不支持分享API，则复制链接到剪贴板
                const tempInput = document.createElement('input');
                tempInput.value = window.location.href;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                // 显示提示
                const toast = document.createElement('div');
                toast.textContent = '链接已复制到剪贴板';
                toast.style.position = 'fixed';
                toast.style.bottom = '20px';
                toast.style.left = '50%';
                toast.style.transform = 'translateX(-50%)';
                toast.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                toast.style.color = 'white';
                toast.style.padding = '10px 20px';
                toast.style.borderRadius = '5px';
                toast.style.zIndex = '1000';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 3000);
            }
        });
        
        // 获取长生十二神阶段
        function getChangShengStage(gan, zhi) {
            // 长生十二神顺序：长生、沐浴、冠带、临官、帝旺、衰、病、死、墓、绝、胎、养
            const changShengOrder = ['长生', '沐浴', '冠带', '临官', '帝旺', '衰', '病', '死', '墓', '绝', '胎', '养'];
            
            // 根据日干确定长生位
            const changShengPosition = {
                '甲': 1, '丙': 10, '戊': 10, '庚': 7, '壬': 4,
                '乙': 6, '丁': 9, '己': 9, '辛': 0, '癸': 3
            };
            
            // 获取天干对应的长生位
            const startPos = changShengPosition[gan];
            
            // 地支索引（子=0，丑=1，寅=2，...，亥=11）
            const zhiIndex = {
                '子': 0, '丑': 1, '寅': 2, '卯': 3, '辰': 4, '巳': 5,
                '午': 6, '未': 7, '申': 8, '酉': 9, '戌': 10, '亥': 11
            };
            
            // 计算阳干和阴干的顺逆
            const isYang = ['甲', '丙', '戊', '庚', '壬'].includes(gan);
            let index;
            
            if (isYang) {
                // 阳干顺行
                index = (startPos + zhiIndex[zhi]) % 12;
            } else {
                // 阴干逆行
                index = (startPos - zhiIndex[zhi] + 12) % 12;
            }
            
            return changShengOrder[index];
        }
        
        // 重新分析按钮
        document.getElementById('new-analysis').addEventListener('click', function() {
            // 重置表单
            document.getElementById('bazi-form').reset();
            
            // 隐藏结果区域
            document.getElementById('bazi-result').style.display = 'none';
            
            // 滚动到表单区域
            document.getElementById('bazi-form').scrollIntoView({ behavior: 'smooth' });
        });
    </script>
</body>
</html>